<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0b1220">
  <meta name="description" content="ŸÖŸÉÿ™ÿ®ÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑŸÑÿ£ÿ∑ŸÅÿßŸÑ - Educational Library by Hayl Al-Khadhami">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' https://cdn.plyr.io https://cdn.jsdelivr.net https://www.youtube-nocookie.com; style-src 'self' 'unsafe-inline' https://cdn.plyr.io https://cdnjs.cloudflare.com; img-src 'self' data: https:; media-src 'self' https:; connect-src 'self' https:; frame-src https://www.youtube-nocookie.com https://drive.google.com;">
  
  <title>ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿØÿ±Ÿàÿ≥ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© | Hayl Al-Khadhami</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/halkhadhami/halkhadhami.github.io/master/images/favicon.png">
  
  <!-- Preconnect to external domains for performance -->
  <link rel="preconnect" href="https://cdn.plyr.io">
  <link rel="preconnect" href="https://docs.google.com">
  <link rel="preconnect" href="https://i.ytimg.com">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <!-- Progressive Web App Manifest -->
  <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItin2YTZhdin2YPYqtio2Kkg2KfZhNiq2LnZhNmK2YXZitipIiwKICAic2hvcnRfbmFtZSI6ICLZhdin2YPYqtio2Kkg2KfZhNiv2LHZiNizIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwYjEyMjAiLAogICJ0aGVtZV9jb2xvciI6ICIjMGIxMjIwIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2hhbGtoYWRoYW1pL2hhbGtoYWRoYW1pLmdpdGh1Yi5pby9tYXN0ZXIvaW1hZ2VzL2Zhdmljb24ucG5nIiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICB9CiAgXQp9">
  
  <!-- External Libraries -->
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer">
  
  <style>
    /* ============================================
       üé® CSS CUSTOM PROPERTIES (Design System)
       ============================================ */
    :root {
      /* Color Palette */
      --color-primary: #4ea1ff;
      --color-primary-dark: #3d8ae6;
      --color-primary-light: #6fb4ff;
      --color-secondary: #b46eff;
      --color-success: #3ddc97;
      --color-danger: #ff5b6e;
      --color-warning: #ffb946;
      --color-info: #4ea1ff;
      
      /* Neutral Colors */
      --color-bg-primary: #0b1220;
      --color-bg-secondary: #121b2f;
      --color-bg-tertiary: #1a2538;
      --color-surface: rgba(18, 27, 47, 0.92);
      --color-text-primary: #eef3ff;
      --color-text-secondary: #9fb0d0;
      --color-text-muted: #6b7a99;
      --color-border: rgba(255, 255, 255, 0.1);
      --color-border-focus: rgba(78, 161, 255, 0.5);
      
      /* Spacing Scale */
      --space-xs: 4px;
      --space-sm: 8px;
      --space-md: 16px;
      --space-lg: 24px;
      --space-xl: 32px;
      --space-2xl: 48px;
      
      /* Typography */
      --font-family-base: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      --font-size-xs: 11px;
      --font-size-sm: 13px;
      --font-size-base: 15px;
      --font-size-lg: 17px;
      --font-size-xl: 20px;
      --font-size-2xl: 24px;
      --font-size-3xl: 32px;
      --font-weight-normal: 400;
      --font-weight-medium: 600;
      --font-weight-bold: 700;
      --font-weight-black: 900;
      --line-height-tight: 1.25;
      --line-height-normal: 1.5;
      --line-height-loose: 1.75;
      
      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-full: 9999px;
      
      /* Shadows */
      --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.3);
      --shadow-xl: 0 16px 48px rgba(0, 0, 0, 0.4);
      
      /* Transitions */
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Z-index Scale */
      --z-dropdown: 1000;
      --z-sticky: 1020;
      --z-fixed: 1030;
      --z-modal-backdrop: 1040;
      --z-modal: 1050;
      --z-popover: 1060;
      --z-tooltip: 1070;
      
      /* Layout */
      --container-max-width: 1280px;
      --header-height: 64px;
      --safe-area-inset-top: env(safe-area-inset-top, 0px);
      --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
      --safe-area-inset-left: env(safe-area-inset-left, 0px);
      --safe-area-inset-right: env(safe-area-inset-right, 0px);
    }

    /* ============================================
       üîß BASE & RESET
       ============================================ */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      scroll-behavior: smooth;
    }

    body {
      font-family: var(--font-family-base);
      font-size: var(--font-size-base);
      line-height: var(--line-height-normal);
      color: var(--color-text-primary);
      background: 
        radial-gradient(1200px 600px at 70% 10%, rgba(78, 161, 255, 0.15), transparent),
        radial-gradient(900px 500px at 10% 30%, rgba(180, 110, 255, 0.12), transparent),
        var(--color-bg-primary);
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }

    /* ============================================
       üéØ UTILITY CLASSES
       ============================================ */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    .skeleton {
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0.05) 25%,
        rgba(255, 255, 255, 0.1) 50%,
        rgba(255, 255, 255, 0.05) 75%
      );
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    /* ============================================
       üé™ TOAST NOTIFICATION SYSTEM
       ============================================ */
    .toast-container {
      position: fixed;
      top: calc(var(--header-height) + var(--space-md) + var(--safe-area-inset-top));
      left: var(--space-md);
      right: var(--space-md);
      z-index: var(--z-tooltip);
      pointer-events: none;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      max-width: 420px;
      margin: 0 auto;
    }

    .toast {
      padding: var(--space-md);
      border-radius: var(--radius-md);
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-lg);
      pointer-events: auto;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      animation: slideInDown var(--transition-base);
      backdrop-filter: blur(12px);
    }

    .toast--success { border-color: var(--color-success); }
    .toast--error { border-color: var(--color-danger); }
    .toast--warning { border-color: var(--color-warning); }
    .toast--info { border-color: var(--color-info); }

    .toast__icon {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      display: grid;
      place-items: center;
      border-radius: var(--radius-full);
    }

    .toast--success .toast__icon { background: var(--color-success); color: #fff; }
    .toast--error .toast__icon { background: var(--color-danger); color: #fff; }
    .toast--warning .toast__icon { background: var(--color-warning); color: #000; }
    .toast--info .toast__icon { background: var(--color-info); color: #fff; }

    .toast__message {
      flex: 1;
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-medium);
    }

    .toast__close {
      flex-shrink: 0;
      background: none;
      border: none;
      color: var(--color-text-secondary);
      cursor: pointer;
      padding: var(--space-xs);
      opacity: 0.7;
      transition: opacity var(--transition-fast);
    }

    .toast__close:hover {
      opacity: 1;
    }

    /* ============================================
       üì± HEADER
       ============================================ */
    .app-header {
      position: sticky;
      top: 0;
      z-index: var(--z-sticky);
      background: rgba(11, 18, 32, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--color-border);
      padding-top: var(--safe-area-inset-top);
    }

    .app-header__inner {
      max-width: var(--container-max-width);
      margin: 0 auto;
      padding: var(--space-md);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-md);
      min-height: var(--header-height);
    }

    .app-header__brand {
      flex: 1;
      min-width: 0;
    }

    .app-header__title {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-black);
      color: var(--color-text-primary);
      margin: 0;
      letter-spacing: -0.025em;
    }

    .app-header__subtitle {
      font-size: var(--font-size-xs);
      color: var(--color-text-secondary);
      margin-top: var(--space-xs);
      display: none;
    }

    @media (min-width: 640px) {
      .app-header__subtitle {
        display: block;
      }
    }

    .app-header__actions {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-bold);
      font-family: inherit;
      line-height: 1;
      text-decoration: none;
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 1px solid transparent;
      white-space: nowrap;
      user-select: none;
    }

    .btn:focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .btn--primary {
      background: linear-gradient(135deg, rgba(78, 161, 255, 0.3), rgba(78, 161, 255, 0.2));
      border-color: rgba(78, 161, 255, 0.5);
      color: var(--color-text-primary);
      box-shadow: 0 2px 8px rgba(78, 161, 255, 0.2);
    }

    .btn--primary:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(78, 161, 255, 0.4), rgba(78, 161, 255, 0.3));
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(78, 161, 255, 0.3);
    }

    .btn--primary:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn--ghost {
      background: rgba(255, 255, 255, 0.06);
      border-color: var(--color-border);
      color: var(--color-text-primary);
    }

    .btn--ghost:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--color-border-focus);
    }

    .btn--success {
      background: rgba(61, 220, 151, 0.15);
      border-color: rgba(61, 220, 151, 0.4);
      color: #c8ffe9;
    }

    .btn--success:hover:not(:disabled) {
      background: rgba(61, 220, 151, 0.25);
    }

    .btn--icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: var(--radius-full);
    }

    /* ============================================
       üéõÔ∏è FILTERS SECTION
       ============================================ */
    .filters-section {
      max-width: var(--container-max-width);
      margin: var(--space-lg) auto;
      padding: 0 var(--space-md);
    }

    .filters-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      box-shadow: var(--shadow-md);
      animation: fadeIn var(--transition-base);
    }

    .filters-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-md);
    }

    @media (min-width: 640px) {
      .filters-grid {
        grid-template-columns: 2fr 1fr 1fr;
      }
    }

    @media (min-width: 1024px) {
      .filters-grid {
        grid-template-columns: 2fr 1fr 1fr auto;
      }
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .form-label {
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-secondary);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 12px var(--space-md);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      background: rgba(255, 255, 255, 0.08);
      color: var(--color-text-primary);
      font-size: var(--font-size-base);
      font-family: inherit;
      transition: all var(--transition-fast);
      outline: none;
    }

    .form-input:focus,
    .form-select:focus {
      border-color: var(--color-border-focus);
      background: rgba(255, 255, 255, 0.12);
      box-shadow: 0 0 0 3px rgba(78, 161, 255, 0.15);
    }

    .form-input::placeholder {
      color: var(--color-text-muted);
    }

    .form-select option {
      background: var(--color-bg-secondary);
      color: var(--color-text-primary);
    }

    .filters-meta {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: var(--space-md);
      grid-column: 1 / -1;
    }

    @media (min-width: 1024px) {
      .filters-meta {
        grid-column: auto;
        flex-direction: column;
        align-items: stretch;
      }
    }

    .status-badge {
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      background: rgba(255, 255, 255, 0.06);
      color: var(--color-text-secondary);
      text-align: center;
    }

    .status-badge--loading {
      background: rgba(78, 161, 255, 0.15);
      color: var(--color-primary-light);
    }

    .status-badge--error {
      background: rgba(255, 91, 110, 0.15);
      color: var(--color-danger);
    }

    .status-badge--success {
      background: rgba(61, 220, 151, 0.15);
      color: var(--color-success);
    }

    /* ============================================
       üé¨ CONTENT GRID
       ============================================ */
    .content-section {
      max-width: var(--container-max-width);
      margin: 0 auto var(--space-2xl);
      padding: 0 var(--space-md);
    }

    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--space-lg);
      animation: fadeIn var(--transition-slow);
    }

    @media (min-width: 640px) {
      .content-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      }
    }

    /* Loading Skeletons */
    .skeleton-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .skeleton-card__header {
      padding: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .skeleton-card__title {
      height: 20px;
      width: 80%;
      border-radius: var(--radius-sm);
    }

    .skeleton-card__meta {
      height: 14px;
      width: 60%;
      border-radius: var(--radius-sm);
    }

    .skeleton-card__thumbnail {
      width: 100%;
      padding-bottom: 56.25%;
      position: relative;
    }

    .skeleton-card__actions {
      padding: var(--space-md);
      display: flex;
      gap: var(--space-sm);
    }

    .skeleton-card__button {
      flex: 1;
      height: 40px;
      border-radius: var(--radius-md);
    }

    /* Video Card */
    .video-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: all var(--transition-base);
      animation: scaleIn var(--transition-base);
      position: relative;
    }

    .video-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(78, 161, 255, 0.3);
    }

    .video-card__header {
      padding: var(--space-md);
      border-bottom: 1px solid var(--color-border);
    }

    .video-card__title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin: 0 0 var(--space-sm);
      line-height: var(--line-height-tight);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .video-card__meta {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-xs);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: 4px var(--space-sm);
      border-radius: var(--radius-full);
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--color-border);
      color: var(--color-text-secondary);
    }

    .badge--category {
      background: rgba(78, 161, 255, 0.15);
      border-color: rgba(78, 161, 255, 0.3);
      color: var(--color-primary-light);
    }

    .video-card__thumbnail {
      position: relative;
      width: 100%;
      padding-bottom: 56.25%;
      background: #000;
      overflow: hidden;
      cursor: pointer;
      user-select: none;
    }

    .video-card__thumbnail-img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform var(--transition-slow);
    }

    .video-card:hover .video-card__thumbnail-img {
      transform: scale(1.05);
    }

    .video-card__thumbnail-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.2),
        rgba(0, 0, 0, 0.6)
      );
      transition: background var(--transition-base);
    }

    .video-card:hover .video-card__thumbnail-overlay {
      background: rgba(0, 0, 0, 0.3);
    }

    .play-button {
      width: 68px;
      height: 68px;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.95);
      border: none;
      display: grid;
      place-items: center;
      cursor: pointer;
      transition: all var(--transition-base);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }

    .video-card:hover .play-button {
      transform: scale(1.15);
      background: #fff;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.6);
    }

    .play-button::before {
      content: '';
      width: 0;
      height: 0;
      border-top: 12px solid transparent;
      border-bottom: 12px solid transparent;
      border-left: 18px solid var(--color-primary);
      margin-left: 4px;
    }

    .video-card__actions {
      padding: var(--space-md);
      display: flex;
      gap: var(--space-sm);
      border-top: 1px solid var(--color-border);
      background: rgba(0, 0, 0, 0.2);
    }

    .video-card__actions .btn {
      flex: 1;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: var(--space-2xl) var(--space-lg);
      animation: fadeIn var(--transition-slow);
    }

    .empty-state__icon {
      font-size: 64px;
      color: var(--color-text-muted);
      margin-bottom: var(--space-lg);
    }

    .empty-state__title {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-sm);
    }

    .empty-state__description {
      font-size: var(--font-size-base);
      color: var(--color-text-secondary);
      max-width: 400px;
      margin: 0 auto;
    }

    /* ============================================
       üé• VIDEO PLAYER MODAL
       ============================================ */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: var(--z-modal-backdrop);
      opacity: 0;
      transition: opacity var(--transition-base);
      pointer-events: none;
    }

    .modal-backdrop.is-active {
      opacity: 1;
      pointer-events: auto;
    }

    .player-modal {
      position: fixed;
      inset: 0;
      z-index: var(--z-modal);
      display: flex;
      flex-direction: column;
      opacity: 0;
      transform: scale(0.95);
      transition: all var(--transition-base);
      pointer-events: none;
    }

    .player-modal.is-active {
      opacity: 1;
      transform: scale(1);
      pointer-events: auto;
    }

    .player-modal__header {
      flex-shrink: 0;
      display: flex;
      align-items: center;
      gap: var(--space-md);
      padding: var(--space-md);
      padding-top: calc(var(--space-md) + var(--safe-area-inset-top));
      background: var(--color-bg-primary);
      border-bottom: 1px solid var(--color-border);
    }

    .player-modal__title {
      flex: 1;
      min-width: 0;
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .player-modal__stage {
      flex: 1;
      min-height: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      position: relative;
    }

    .player-modal__stage video,
    .player-modal__stage iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
    }

    .player-modal__stage video {
      object-fit: contain;
    }

    .player-modal__loading {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: var(--space-md);
      color: var(--color-text-secondary);
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--color-primary);
      border-radius: var(--radius-full);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ============================================
       üë£ FOOTER
       ============================================ */
    .app-footer {
      margin-top: var(--space-2xl);
      border-top: 1px solid var(--color-border);
      background: rgba(0, 0, 0, 0.3);
      padding: var(--space-xl) var(--space-md);
      padding-bottom: calc(var(--space-xl) + var(--safe-area-inset-bottom));
    }

    .app-footer__inner {
      max-width: var(--container-max-width);
      margin: 0 auto;
    }

    .app-footer__content {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-lg);
      margin-bottom: var(--space-lg);
    }

    .app-footer__brand h3 {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-black);
      color: var(--color-text-primary);
      margin: 0 0 var(--space-xs);
    }

    .app-footer__brand p {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      margin: 0;
    }

    .app-footer__social {
      display: flex;
      gap: var(--space-sm);
    }

    .social-link {
      width: 44px;
      height: 44px;
      display: grid;
      place-items: center;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      background: rgba(255, 255, 255, 0.06);
      color: var(--color-text-primary);
      text-decoration: none;
      transition: all var(--transition-fast);
      font-size: 18px;
    }

    .social-link:hover {
      background: rgba(78, 161, 255, 0.2);
      border-color: var(--color-primary);
      transform: translateY(-2px);
    }

    .app-footer__bottom {
      padding-top: var(--space-lg);
      border-top: 1px solid rgba(255, 255, 255, 0.08);
      text-align: center;
    }

    .app-footer__bottom p {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      margin: 0;
    }

    /* ============================================
       üì± RESPONSIVE ADJUSTMENTS
       ============================================ */
    @media (max-width: 640px) {
      :root {
        --space-md: 12px;
        --space-lg: 20px;
      }

      .app-header__title {
        font-size: var(--font-size-lg);
      }

      .content-grid {
        grid-template-columns: 1fr;
      }

      .video-card__actions {
        flex-direction: column;
      }

      .video-card__actions .btn {
        width: 100%;
      }
    }

    /* ============================================
       ‚ôø ACCESSIBILITY
       ============================================ */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Focus visible for keyboard navigation */
    :focus-visible {
      outline: 2px solid var(--color-primary);
      outline-offset: 2px;
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --color-border: rgba(255, 255, 255, 0.3);
      }
    }
  </style>
</head>

<body>
  <!-- Toast Notification Container -->
  <div id="toast-container" class="toast-container" role="status" aria-live="polite" aria-atomic="true"></div>

  <!-- App Header -->
  <header class="app-header" role="banner">
    <div class="app-header__inner">
      <div class="app-header__brand">
        <h1 class="app-header__title">üé¨ ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿØÿ±Ÿàÿ≥</h1>
        <p class="app-header__subtitle">ŸÖŸÜÿµÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑŸÑÿ£ÿ∑ŸÅÿßŸÑ</p>
      </div>
      <div class="app-header__actions">
        <button 
          id="refresh-btn" 
          class="btn btn--primary" 
          type="button"
          aria-label="ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™">
          <i class="fas fa-sync-alt" aria-hidden="true"></i>
          <span>ÿ™ÿ≠ÿØŸäÿ´</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main id="app-main" role="main">
    <!-- Filters Section -->
    <section class="filters-section" aria-label="ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑÿ™ÿµŸÅŸäÿ©">
      <div class="filters-card">
        <form id="filters-form" class="filters-grid" role="search">
          <div class="form-field">
            <label for="search-input" class="form-label">
              <i class="fas fa-search" aria-hidden="true"></i>
              ÿ®ÿ≠ÿ´
            </label>
            <input 
              type="search" 
              id="search-input" 
              class="form-input" 
              placeholder="ÿßÿ®ÿ≠ÿ´ ÿ®ÿßŸÑÿπŸÜŸàÿßŸÜ..."
              autocomplete="off"
              aria-label="ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿØÿ±Ÿàÿ≥">
          </div>

          <div class="form-field">
            <label for="category-select" class="form-label">
              <i class="fas fa-folder" aria-hidden="true"></i>
              ÿßŸÑŸÖÿßÿØÿ©
            </label>
            <select 
              id="category-select" 
              class="form-select"
              aria-label="ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿßÿØÿ©">
              <option value="all">ŸÉŸÑ ÿßŸÑŸÖŸàÿßÿØ</option>
            </select>
          </div>

          <div class="form-field">
            <label for="time-select" class="form-label">
              <i class="fas fa-calendar" aria-hidden="true"></i>
              ÿßŸÑŸÅÿ™ÿ±ÿ©
            </label>
            <select 
              id="time-select" 
              class="form-select"
              aria-label="ÿßÿÆÿ™ÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©">
              <option value="all">ÿßŸÑŸÉŸÑ</option>
              <option value="today">ÿßŸÑŸäŸàŸÖ</option>
              <option value="yesterday">ÿ£ŸÖÿ≥</option>
              <option value="week">ÿ¢ÿÆÿ± ÿ£ÿ≥ÿ®Ÿàÿπ</option>
              <option value="month">ÿ¢ÿÆÿ± ÿ¥Ÿáÿ±</option>
              <option value="year">ÿ¢ÿÆÿ± ÿ≥ŸÜÿ©</option>
            </select>
          </div>

          <div class="filters-meta">
            <div id="status-badge" class="status-badge" role="status" aria-live="polite">
              ÿ¨ÿßŸáÿ≤
            </div>
          </div>
        </form>
      </div>
    </section>

    <!-- Content Grid -->
    <section class="content-section">
      <div id="content-grid" class="content-grid" role="list" aria-label="ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿØÿ±Ÿàÿ≥"></div>
    </section>
  </main>

  <!-- Video Player Modal -->
  <div id="modal-backdrop" class="modal-backdrop" aria-hidden="true"></div>
  <div id="player-modal" class="player-modal" role="dialog" aria-modal="true" aria-labelledby="player-modal-title" aria-hidden="true">
    <div class="player-modal__header">
      <button 
        id="close-modal-btn" 
        class="btn btn--ghost" 
        type="button"
        aria-label="ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ">
        <i class="fas fa-times" aria-hidden="true"></i>
        ÿ•ÿ∫ŸÑÿßŸÇ
      </button>
      <h2 id="player-modal-title" class="player-modal__title"></h2>
      <a 
        id="external-link-btn" 
        href="#" 
        target="_blank" 
        rel="noopener noreferrer"
        class="btn btn--ghost"
        style="display: none;"
        aria-label="ŸÅÿ™ÿ≠ ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿ¨ÿØŸäÿØÿ©">
        <i class="fas fa-external-link-alt" aria-hidden="true"></i>
        <span class="sr-only">ŸÅÿ™ÿ≠ ÿÆÿßÿ±ÿ¨Ÿä</span>
      </a>
    </div>
    <div id="player-stage" class="player-modal__stage"></div>
  </div>

  <!-- Footer -->
  <footer class="app-footer" role="contentinfo">
    <div class="app-footer__inner">

      <div class="app-footer__bottom">
	  <h3>Hayl Al-Khadhami</h3>
          <p>Automation Engineer | Researcher | Educator</p>
        <p>&copy; 2026 Hayl Al-Khadhami. All rights reserved. Built with</p>
      </div>
    </div>
  </footer>

  <!-- External Libraries -->
  <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
  
  <!-- Application Script -->
<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

<script>
'use strict';

// ============================================
// üìä CONFIGURATION
// ============================================
const CONFIG = {
  SHEET_CSV_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTLx7eaIKwI4yVGNE84i_btsnqMDmQZwC7bQFkMyUiuMqo4nGyC-K7Jq0fYZ7TULPZi4JUv1RnqEkwr/pub?output=csv',
  DEBOUNCE_DELAY: 300,
  TOAST_DURATION: 4000,
  CACHE_DURATION: 5 * 60 * 1000,
  MAX_RETRIES: 3,
  RETRY_DELAY: 1000,
};

const CATEGORY_CONFIG = {
  ORDER: ['Arabic', 'Art', 'Chinese', 'English', 'Fun', 'Islamic', 'Kuran', 'Math', 'Other'],
  TRANSLATIONS: {
    Arabic: 'ÿπÿ±ÿ®Ÿä',
    Art: 'ŸÅŸÜ',
    Chinese: 'ÿµŸäŸÜŸä',
    English: 'ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä',
    Fun: 'ÿ™ÿ±ŸÅŸäŸá',
    Islamic: 'ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™',
    Kuran: 'ŸÇÿ±ÿ¢ŸÜ',
    Math: 'ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™',
    Other: 'ÿ£ÿÆÿ±Ÿâ',
  },
};

// ============================================
// üõ†Ô∏è UTILITIES
// ============================================
const Utils = {
  debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  },

  escapeHtml(unsafe) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;',
    };
    return String(unsafe || '').replace(/[&<>"']/g, (m) => map[m]);
  },

  parseDate(dateStr) {
    if (!dateStr) return null;
    const parts = String(dateStr).trim().split('/');
    if (parts.length !== 3) return null;
    const [dd, mm, yyyy] = parts.map(Number);
    if (!dd || !mm || !yyyy) return null;
    return new Date(yyyy, mm - 1, dd, 12, 0, 0);
  },

  daysBetween(date1, date2) {
    const MS_PER_DAY = 86400000;
    const d1 = new Date(date1.getFullYear(), date1.getMonth(), date1.getDate());
    const d2 = new Date(date2.getFullYear(), date2.getMonth(), date2.getDate());
    return Math.round((d1 - d2) / MS_PER_DAY);
  },

  formatDate(date) {
    if (!date) return '‚Äî';
    try {
      return new Intl.DateTimeFormat('ar', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
      }).format(date);
    } catch {
      return date.toLocaleDateString();
    }
  },

  extractYoutubeId(url) {
    const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
    const match = String(url || '').match(regex);
    return match ? match[1] : null;
  },

  extractDriveId(url) {
    const str = String(url || '');
    const patterns = [
      /\/file\/d\/([^/]+)/,
      /[?&]id=([^&]+)/,
      /\/d\/([^/]+)/,
    ];
    
    for (const pattern of patterns) {
      const match = str.match(pattern);
      if (match) return match[1];
    }
    return null;
  },

  getDriveUrls(url) {
    const id = this.extractDriveId(url);
    if (!id) return null;
    return {
      id,
      preview: `https://drive.google.com/file/d/${id}/preview`,
      download: `https://drive.google.com/uc?export=download&id=${id}`,
      view: `https://drive.google.com/file/d/${id}/view`,
      thumbnail: `https://drive.google.com/thumbnail?id=${id}&sz=w640`,
    };
  },

  getContentType(url) {
    const urlLower = String(url || '').toLowerCase();
    const cleanUrl = urlLower.split('?')[0];

    if (this.extractYoutubeId(url)) return 'youtube';
    if (urlLower.includes('drive.google.com')) return 'drive';
    if (/\.(mp4|webm|ogg|mov|m4v)$/i.test(cleanUrl)) return 'video';
    if (/\.(pdf)$/i.test(cleanUrl)) return 'pdf';
    if (/\.(png|jpg|jpeg|gif|webp|bmp|svg)$/i.test(cleanUrl)) return 'image';
    return 'link';
  },

  parseCSV(csv) {
    const rows = [];
    let row = [];
    let current = '';
    let inQuotes = false;

    for (let i = 0; i < csv.length; i++) {
      const char = csv[i];
      const next = csv[i + 1];

      if (char === '"' && inQuotes && next === '"') {
        current += '"';
        i++;
        continue;
      }

      if (char === '"') {
        inQuotes = !inQuotes;
        continue;
      }

      if (!inQuotes && char === ',') {
        row.push(current);
        current = '';
        continue;
      }

      if (!inQuotes && (char === '\n' || char === '\r')) {
        if (char === '\r' && next === '\n') i++;
        row.push(current);
        current = '';
        if (row.some((c) => String(c).trim() !== '')) {
          rows.push(row);
        }
        row = [];
        continue;
      }

      current += char;
    }

    row.push(current);
    if (row.some((c) => String(c).trim() !== '')) {
      rows.push(row);
    }

    return rows;
  },

  createCache() {
    const cache = new Map();
    return {
      get(key) {
        const item = cache.get(key);
        if (!item) return null;
        if (Date.now() > item.expiry) {
          cache.delete(key);
          return null;
        }
        return item.value;
      },
      set(key, value, ttl = CONFIG.CACHE_DURATION) {
        cache.set(key, {
          value,
          expiry: Date.now() + ttl,
        });
      },
      clear() {
        cache.clear();
      },
    };
  },
};

// ============================================
// üé® UI COMPONENTS
// ============================================
const UI = {
  Toast: {
    container: document.getElementById('toast-container'),

    show(message, type = 'info', duration = CONFIG.TOAST_DURATION) {
      const toast = document.createElement('div');
      toast.className = `toast toast--${type}`;
      toast.setAttribute('role', 'alert');

      const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle',
      };

      toast.innerHTML = `
        <div class="toast__icon">
          <i class="fas ${icons[type] || icons.info}" aria-hidden="true"></i>
        </div>
        <div class="toast__message">${Utils.escapeHtml(message)}</div>
        <button class="toast__close" type="button" aria-label="ÿ•ÿ∫ŸÑÿßŸÇ">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      `;

      const closeBtn = toast.querySelector('.toast__close');
      const remove = () => {
        toast.style.animation = 'slideInDown var(--transition-base) reverse';
        setTimeout(() => toast.remove(), 250);
      };

      closeBtn.addEventListener('click', remove);
      this.container.appendChild(toast);

      if (duration > 0) {
        setTimeout(remove, duration);
      }
    },

    success(message) {
      this.show(message, 'success');
    },

    error(message) {
      this.show(message, 'error');
    },

    warning(message) {
      this.show(message, 'warning');
    },

    info(message) {
      this.show(message, 'info');
    },
  },

  StatusBadge: {
    element: document.getElementById('status-badge'),

    update(text, state = 'default') {
      this.element.textContent = text;
      this.element.className = 'status-badge';
      if (state !== 'default') {
        this.element.classList.add(`status-badge--${state}`);
      }
    },

    loading(text = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...') {
      this.update(text, 'loading');
    },

    success(text) {
      this.update(text, 'success');
    },

    error(text) {
      this.update(text, 'error');
    },

    default(text = 'ÿ¨ÿßŸáÿ≤') {
      this.update(text, 'default');
    },
  },

  Skeleton: {
    create(count = 6) {
      const skeletons = [];
      for (let i = 0; i < count; i++) {
        const skeleton = document.createElement('div');
        skeleton.className = 'skeleton-card';
        skeleton.setAttribute('aria-busy', 'true');
        skeleton.setAttribute('aria-label', 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ');
        skeleton.innerHTML = `
          <div class="skeleton-card__header">
            <div class="skeleton-card__title skeleton"></div>
            <div class="skeleton-card__meta skeleton"></div>
          </div>
          <div class="skeleton-card__thumbnail skeleton"></div>
          <div class="skeleton-card__actions">
            <div class="skeleton-card__button skeleton"></div>
            <div class="skeleton-card__button skeleton"></div>
          </div>
        `;
        skeletons.push(skeleton);
      }
      return skeletons;
    },
  },

  EmptyState: {
    create(title, description, icon = 'fa-inbox') {
      const empty = document.createElement('div');
      empty.className = 'empty-state';
      empty.innerHTML = `
        <div class="empty-state__icon">
          <i class="fas ${icon}" aria-hidden="true"></i>
        </div>
        <h3 class="empty-state__title">${Utils.escapeHtml(title)}</h3>
        <p class="empty-state__description">${Utils.escapeHtml(description)}</p>
      `;
      return empty;
    },
  },

  VideoCard: {
    create(lesson, onPlay) {
      const card = document.createElement('article');
      card.className = 'video-card';
      card.setAttribute('role', 'listitem');
      card.dataset.lessonId = lesson.id;

      const categoryLabel = CATEGORY_CONFIG.TRANSLATIONS[lesson.category] || lesson.category;
      const contentType = Utils.getContentType(lesson.url);
      const driveUrls = Utils.getDriveUrls(lesson.url);
      const youtubeId = Utils.extractYoutubeId(lesson.url);

      let thumbnail = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="640" height="360"%3E%3Crect fill="%230b1220" width="640" height="360"/%3E%3Ctext x="50%25" y="50%25" dominant-baseline="middle" text-anchor="middle" fill="%239fb0d0" font-size="20" font-family="sans-serif"%3E%F0%9F%8E%AC%3C/text%3E%3C/svg%3E';
      
      if (youtubeId) {
        thumbnail = `https://i.ytimg.com/vi/${youtubeId}/hqdefault.jpg`;
      } else if (driveUrls) {
        thumbnail = driveUrls.thumbnail;
      }

      let downloadUrl = lesson.url;
      if (driveUrls) {
        downloadUrl = driveUrls.download;
      }

      card.innerHTML = `
        <div class="video-card__header">
          <h3 class="video-card__title">${Utils.escapeHtml(lesson.title)}</h3>
          <div class="video-card__meta">
            <span class="badge badge--category">
              <i class="fas fa-folder" aria-hidden="true"></i>
              ${Utils.escapeHtml(categoryLabel)}
            </span>
            <span class="badge">
              <i class="fas fa-calendar" aria-hidden="true"></i>
              ${Utils.escapeHtml(Utils.formatDate(lesson.date))}
            </span>
            ${lesson.id ? `<span class="badge">#${Utils.escapeHtml(lesson.id)}</span>` : ''}
          </div>
        </div>
        <div class="video-card__thumbnail" role="button" tabindex="0" aria-label="ÿ™ÿ¥ÿ∫ŸäŸÑ ${Utils.escapeHtml(lesson.title)}">
          <img 
            src="${thumbnail}" 
            alt="${Utils.escapeHtml(lesson.title)}"
            class="video-card__thumbnail-img"
            loading="lazy"
            referrerpolicy="no-referrer">
          <div class="video-card__thumbnail-overlay">
            <button class="play-button" type="button" aria-label="ÿ™ÿ¥ÿ∫ŸäŸÑ"></button>
          </div>
        </div>
        <div class="video-card__actions">
          <button class="btn btn--primary btn-play" type="button">
            <i class="fas fa-play" aria-hidden="true"></i>
            ŸÖÿ¥ÿßŸáÿØÿ©
          </button>
          ${youtubeId 
            ? `<a href="https://www.youtube.com/watch?v=${youtubeId}" target="_blank" rel="noopener" class="btn btn--success">
                 <i class="fab fa-youtube" aria-hidden="true"></i>
                 ŸäŸàÿ™ŸäŸàÿ®
               </a>`
            : `<a href="${downloadUrl}" target="_blank" rel="noopener" download class="btn btn--success">
                 <i class="fas fa-download" aria-hidden="true"></i>
                 ÿ™ÿ≠ŸÖŸäŸÑ
               </a>`
          }
        </div>
      `;

      // IMPORTANT: Only "Watch" button and thumbnail trigger the player modal
      const handlePlay = (e) => {
        e.preventDefault();
        e.stopPropagation();
        onPlay(lesson);
      };

      card.querySelector('.video-card__thumbnail').addEventListener('click', handlePlay);
      card.querySelector('.btn-play').addEventListener('click', handlePlay);
      
      card.querySelector('.video-card__thumbnail').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          handlePlay(e);
        }
      });

      return card;
    },
  },
};

// ============================================
// üì° DATA SERVICE
// ============================================
const DataService = {
  cache: Utils.createCache(),

  async fetchWithRetry(url, retries = CONFIG.MAX_RETRIES) {
    for (let i = 0; i < retries; i++) {
      try {
        const response = await fetch(url, {
          cache: 'no-store',
          headers: {
            'Accept': 'text/csv',
          },
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        return await response.text();
      } catch (error) {
        if (i === retries - 1) throw error;
        await new Promise((resolve) => setTimeout(resolve, CONFIG.RETRY_DELAY * (i + 1)));
      }
    }
  },

  async loadLessons(forceRefresh = false) {
    const cacheKey = 'lessons_data';

    if (!forceRefresh) {
      const cached = this.cache.get(cacheKey);
      if (cached) return cached;
    }

    const csv = await this.fetchWithRetry(CONFIG.SHEET_CSV_URL);
    const rows = Utils.parseCSV(csv);

    if (rows.length < 2) {
      throw new Error('CSV file is empty or invalid');
    }

    const headers = rows[0].map((h) => String(h).trim());
    const data = rows.slice(1).map((cols) => {
      const obj = {};
      headers.forEach((header, index) => {
        obj[header] = cols[index] || '';
      });
      return obj;
    });

    const lessons = data
      .map((row) => ({
        id: (row.LessonID || '').trim(),
        title: (row.Title || 'ÿ®ÿØŸàŸÜ ÿπŸÜŸàÿßŸÜ').trim(),
        category: (row.Category || 'Other').trim(),
        date: Utils.parseDate((row.DateUploaded || '').trim()),
        url: (row.ContentURL || '').trim(),
      }))
      .filter((lesson) => lesson.title && lesson.url);

    lessons.sort((a, b) => {
      const dateA = a.date ? a.date.getTime() : 0;
      const dateB = b.date ? b.date.getTime() : 0;
      return dateB - dateA;
    });

    this.cache.set(cacheKey, lessons);
    return lessons;
  },

  getCategories(lessons) {
    const uniqueCategories = new Set(lessons.map((l) => l.category || 'Other'));
    const sortedCategories = CATEGORY_CONFIG.ORDER.filter((c) => uniqueCategories.has(c));
    const otherCategories = [...uniqueCategories].filter((c) => !CATEGORY_CONFIG.ORDER.includes(c));
    return [...sortedCategories, ...otherCategories];
  },
};

// ============================================
// üéØ FILTERS
// ============================================
const FilterStrategies = {
  search(lessons, query) {
    if (!query) return lessons;
    const lowerQuery = query.toLowerCase();
    return lessons.filter((lesson) => lesson.title.toLowerCase().includes(lowerQuery));
  },

  category(lessons, category) {
    if (!category || category === 'all') return lessons;
    return lessons.filter((lesson) => lesson.category === category);
  },

  timeRange(lessons, timeRange) {
    if (!timeRange || timeRange === 'all') return lessons;

    const now = new Date();
    const predicates = {
      today: (lesson) => lesson.date && Utils.daysBetween(now, lesson.date) === 0,
      yesterday: (lesson) => lesson.date && Utils.daysBetween(now, lesson.date) === 1,
      week: (lesson) => lesson.date && Utils.daysBetween(now, lesson.date) >= 0 && Utils.daysBetween(now, lesson.date) <= 7,
      month: (lesson) => lesson.date && Utils.daysBetween(now, lesson.date) >= 0 && Utils.daysBetween(now, lesson.date) <= 30,
      year: (lesson) => lesson.date && Utils.daysBetween(now, lesson.date) >= 0 && Utils.daysBetween(now, lesson.date) <= 365,
    };

    const predicate = predicates[timeRange];
    return predicate ? lessons.filter(predicate) : lessons;
  },
};

// ============================================
// üé¨ PLAYER MANAGER (FIXED)
// ============================================
const PlayerManager = {
  modal: document.getElementById('player-modal'),
  backdrop: document.getElementById('modal-backdrop'),
  stage: document.getElementById('player-stage'),
  title: document.getElementById('player-modal-title'),
  closeBtn: document.getElementById('close-modal-btn'),
  externalBtn: document.getElementById('external-link-btn'),
  currentPlayer: null,
  loadingOverlay: null,
  readyTimeout: null,
  sessionToken: 0,

  init() {
    this.closeBtn.addEventListener('click', () => this.close());
    this.backdrop.addEventListener('click', () => this.close());
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && this.modal.classList.contains('is-active')) {
        this.close();
      }
    });
  },

  hideLoading() {
    if (this.loadingOverlay) {
      this.loadingOverlay.style.display = 'none';
    }
    clearTimeout(this.readyTimeout);
  },

  showLoading() {
    if (this.loadingOverlay) {
      this.loadingOverlay.style.display = 'flex';
    }
  },

  async open(lesson) {
    const token = ++this.sessionToken;

    this.title.textContent = lesson.title;
    this.modal.classList.add('is-active');
    this.backdrop.classList.add('is-active');
    this.modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';

    // Build stage structure
    this.stage.innerHTML = `
      <div style="position:relative; width:100%; height:100%;">
        <div id="player-mount" style="position:absolute; inset:0;"></div>
        <div id="player-loading" style="position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:12px; background:rgba(0,0,0,0.7); backdrop-filter:blur(4px); z-index:999;">
          <div class="spinner"></div>
          <p style="margin:0; color:#9fb0d0; font-weight:700; font-size:14px;">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
        </div>
      </div>
    `;

    this.loadingOverlay = document.getElementById('player-loading');
    const mountPoint = document.getElementById('player-mount');

    // Set timeout to auto-hide loader after 10 seconds
    this.readyTimeout = setTimeout(() => {
      if (token === this.sessionToken) {
        this.hideLoading();
        UI.Toast.warning('Ÿäÿ≥ÿ™ÿ∫ÿ±ŸÇ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ŸàŸÇÿ™Ÿãÿß. ÿ¨ÿ±ÿ® ÿ≤ÿ± "ŸÅÿ™ÿ≠ ÿÆÿßÿ±ÿ¨Ÿä"');
      }
    }, 10000);

    try {
      await this.loadContent(lesson, mountPoint, token);
    } catch (error) {
      console.error('Player error:', error);
      this.hideLoading();
      mountPoint.innerHTML = `
        <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; color:var(--color-danger); padding:20px; text-align:center;">
          <i class="fas fa-exclamation-triangle" style="font-size:48px; margin-bottom:16px;"></i>
          <p style="font-size:16px; font-weight:700;">ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ</p>
          <p style="font-size:14px; color:var(--color-text-secondary); margin-top:8px;">ÿ¨ÿ±ÿ® ÿ≤ÿ± "ŸÅÿ™ÿ≠ ÿÆÿßÿ±ÿ¨Ÿä" ÿ£ÿ≥ŸÅŸÑ ÿßŸÑÿπŸÜŸàÿßŸÜ</p>
        </div>
      `;
      UI.Toast.error('ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ');
    }
  },

  async loadContent(lesson, mountEl, token) {
    const isStale = () => token !== this.sessionToken;

    const contentType = Utils.getContentType(lesson.url);
    const youtubeId = Utils.extractYoutubeId(lesson.url);
    const driveUrls = Utils.getDriveUrls(lesson.url);

    this.externalBtn.style.display = 'none';

    // YouTube
    if (youtubeId) {
      const ytUrl = `https://www.youtube.com/watch?v=${youtubeId}`;
      this.externalBtn.href = ytUrl;
      this.externalBtn.style.display = 'inline-flex';

      mountEl.innerHTML = `<div id="plyr-youtube" data-plyr-provider="youtube" data-plyr-embed-id="${youtubeId}"></div>`;
      
      try {
        this.currentPlayer = new Plyr('#plyr-youtube', {
          controls: ['play-large','play','progress','current-time','mute','volume','captions','settings','pip','airplay','fullscreen'],
          youtube: { noCookie: true, rel: 0, showinfo: 0, iv_load_policy: 3, modestbranding: 1 },
        });

        this.currentPlayer.on('ready', () => {
          if (!isStale()) this.hideLoading();
        });

        this.currentPlayer.on('playing', () => {
          if (!isStale()) this.hideLoading();
        });
      } catch (e) {
        console.error('Plyr YouTube error:', e);
        this.hideLoading();
      }
      return;
    }

    // Google Drive
    if (driveUrls) {
      this.externalBtn.href = driveUrls.view;
      this.externalBtn.style.display = 'inline-flex';

      const iframe = document.createElement('iframe');
      iframe.src = driveUrls.preview;
      iframe.style.cssText = 'width:100%; height:100%; border:0;';
      iframe.setAttribute('allowfullscreen', '');
      iframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
      
      iframe.addEventListener('load', () => {
        if (!isStale()) {
          setTimeout(() => this.hideLoading(), 500);
        }
      });

      iframe.addEventListener('error', () => {
        if (!isStale()) this.hideLoading();
      });

      mountEl.appendChild(iframe);
      return;
    }

    // Direct video file
    if (contentType === 'video') {
      this.externalBtn.href = lesson.url;
      this.externalBtn.style.display = 'inline-flex';

      const video = document.createElement('video');
      video.controls = true;
      video.preload = 'metadata';
      video.style.cssText = 'width:100%; height:100%; object-fit:contain;';
      video.setAttribute('playsinline', '');
      
      const source = document.createElement('source');
      source.src = lesson.url;
      video.appendChild(source);

      const handleReady = () => {
        if (!isStale()) this.hideLoading();
      };

      video.addEventListener('loadedmetadata', handleReady, { once: true });
      video.addEventListener('canplay', handleReady, { once: true });
      video.addEventListener('playing', handleReady, { once: true });
      video.addEventListener('error', () => {
        if (!isStale()) {
          this.hideLoading();
          UI.Toast.error('ŸÅÿ¥ŸÑ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà. ÿ¨ÿ±ÿ® ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿÆÿßÿ±ÿ¨Ÿä.');
        }
      });

      mountEl.appendChild(video);
      return;
    }

    // Fallback iframe
    this.externalBtn.href = lesson.url;
    this.externalBtn.style.display = 'inline-flex';

    const iframe = document.createElement('iframe');
    iframe.src = lesson.url;
    iframe.style.cssText = 'width:100%; height:100%; border:0;';
    iframe.setAttribute('allowfullscreen', '');
    
    iframe.addEventListener('load', () => {
      if (!isStale()) {
        setTimeout(() => this.hideLoading(), 500);
      }
    });

    mountEl.appendChild(iframe);
  },

  close() {
    clearTimeout(this.readyTimeout);

    if (this.currentPlayer) {
      try {
        this.currentPlayer.destroy();
      } catch (e) {
        console.error('Player destroy error:', e);
      }
      this.currentPlayer = null;
    }

    this.stage.innerHTML = '';
    this.loadingOverlay = null;
    this.modal.classList.remove('is-active');
    this.backdrop.classList.remove('is-active');
    this.modal.setAttribute('aria-hidden', 'true');
    this.externalBtn.style.display = 'none';
    document.body.style.overflow = '';
  },
};

// ============================================
// üéÆ APP CONTROLLER
// ============================================
const App = {
  state: {
    lessons: [],
    filteredLessons: [],
    filters: {
      search: '',
      category: 'all',
      timeRange: 'all',
    },
  },

  elements: {
    contentGrid: document.getElementById('content-grid'),
    searchInput: document.getElementById('search-input'),
    categorySelect: document.getElementById('category-select'),
    timeSelect: document.getElementById('time-select'),
    refreshBtn: document.getElementById('refresh-btn'),
  },

  async init() {
    console.log('üöÄ Initializing application...');
    
    PlayerManager.init();
    this.setupEventListeners();
    await this.loadData();

    console.log('‚úÖ Application ready');
  },

  setupEventListeners() {
    this.elements.searchInput.addEventListener(
      'input',
      Utils.debounce((e) => {
        this.state.filters.search = e.target.value;
        this.applyFilters();
      }, CONFIG.DEBOUNCE_DELAY)
    );

    this.elements.categorySelect.addEventListener('change', (e) => {
      this.state.filters.category = e.target.value;
      this.applyFilters();
    });

    this.elements.timeSelect.addEventListener('change', (e) => {
      this.state.filters.timeRange = e.target.value;
      this.applyFilters();
    });

    this.elements.refreshBtn.addEventListener('click', () => {
      this.loadData(true);
    });
  },

  async loadData(forceRefresh = false) {
    try {
      UI.StatusBadge.loading('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...');
      
      this.elements.contentGrid.innerHTML = '';
      UI.Skeleton.create(6).forEach((skeleton) => {
        this.elements.contentGrid.appendChild(skeleton);
      });

      this.state.lessons = await DataService.loadLessons(forceRefresh);
      this.updateCategorySelect();
      this.applyFilters();

      UI.StatusBadge.success(`‚úì ${this.state.lessons.length} ÿØÿ±ÿ≥`);
      
      if (forceRefresh) {
        UI.Toast.success('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠');
      }
    } catch (error) {
      console.error('Load data error:', error);
      UI.StatusBadge.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ');
      UI.Toast.error('ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.');

      this.elements.contentGrid.innerHTML = '';
      this.elements.contentGrid.appendChild(
        UI.EmptyState.create(
          'ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
          'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ ŸàÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.',
          'fa-exclamation-triangle'
        )
      );
    }
  },

  updateCategorySelect() {
    const categories = DataService.getCategories(this.state.lessons);
    
    this.elements.categorySelect.innerHTML = '<option value="all">ŸÉŸÑ ÿßŸÑŸÖŸàÿßÿØ</option>';
    
    categories.forEach((category) => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = CATEGORY_CONFIG.TRANSLATIONS[category] || category;
      this.elements.categorySelect.appendChild(option);
    });
  },

  applyFilters() {
    let filtered = [...this.state.lessons];

    filtered = FilterStrategies.search(filtered, this.state.filters.search);
    filtered = FilterStrategies.category(filtered, this.state.filters.category);
    filtered = FilterStrategies.timeRange(filtered, this.state.filters.timeRange);

    this.state.filteredLessons = filtered;
    this.render();
  },

  render() {
    this.elements.contentGrid.innerHTML = '';

    if (this.state.filteredLessons.length === 0) {
      const emptyState = UI.EmptyState.create(
        'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨',
        'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿØÿ±Ÿàÿ≥ ÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ®ÿ≠ÿ´. ÿ≠ÿßŸàŸÑ ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÅŸÑÿßÿ™ÿ±.',
        'fa-search'
      );
      this.elements.contentGrid.appendChild(emptyState);
      return;
    }

    this.state.filteredLessons.forEach((lesson) => {
      const card = UI.VideoCard.create(lesson, (lesson) => {
        PlayerManager.open(lesson);
      });
      this.elements.contentGrid.appendChild(card);
    });
  },
};

// ============================================
// üé¨ START
// ============================================
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => App.init());
} else {
  App.init();
}

window.addEventListener('error', (event) => {
  console.error('Global error:', event.error);
});

window.addEventListener('unhandledrejection', (event) => {
  console.error('Unhandled rejection:', event.reason);
});
</script>

  </script>
</body>
</html>
