<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5.0">
  <meta name="theme-color" content="#0b1220">
  <meta name="description" content="ŸÖŸÜÿµÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© - ŸÖŸàÿßÿØ ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ¥ÿßŸÖŸÑÿ© ŸÖÿπ ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸäÿØŸäŸàŸáÿßÿ™ Ÿàÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÑŸÅÿßÿ™">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿØÿ±Ÿàÿ≥">
  <title>ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿØÿ±Ÿàÿ≥ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© - ŸÖŸÜÿµÿ© Hayl ÿßŸÑÿ™ÿπŸÑŸäŸÖŸäÿ©</title>
  <!-- Favicon - Base64 encoded for zero requests -->
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURQAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAABm1c2AAAAA==">
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURQAAAP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wAABm1c2AAAAA==">
  <!-- Preconnect to critical origins -->
  <link rel="preconnect" href="https://drive.google.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Font optimization -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
  <!-- Performance hints -->
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" as="style">
  <link rel="prefetch" href="https://drive.google.com/thumbnail" as="image">
  <style>
    /* ============================================
       Design System - Professional Token Architecture
       ============================================ */
    :root {
      /* Core Colors - System Design Tokens */
      --color-bg-primary: #0b1220;
      --color-bg-secondary: #121b2f;
      --color-bg-tertiary: #1a243d;
      --color-bg-overlay: rgba(11, 18, 32, 0.95);
      
      /* Text Colors */
      --color-text-primary: #f0f5ff;
      --color-text-secondary: #a8b8d9;
      --color-text-tertiary: #7a8cbb;
      --color-text-disabled: #5a6c8a;
      
      /* Accent Colors - Semantic System */
      --color-accent-primary: #5a9fff;
      --color-accent-primary-dark: #3d7fd4;
      --color-accent-primary-light: #7eb5ff;
      --color-accent-secondary: #6de2b3;
      --color-accent-secondary-dark: #45c99a;
      --color-accent-tertiary: #ffb84d;
      
      /* Status Colors */
      --color-status-success: #3ddc97;
      --color-status-warning: #ffb84d;
      --color-status-error: #ff6b72;
      --color-status-info: #6de2ff;
      
      /* Border System */
      --color-border-primary: rgba(255, 255, 255, 0.08);
      --color-border-secondary: rgba(255, 255, 255, 0.12);
      --color-border-accent: rgba(90, 159, 255, 0.3);
      
      /* Shadow System - Elevation Levels */
      --shadow-level-1: 0 2px 8px rgba(0, 0, 0, 0.15);
      --shadow-level-2: 0 4px 16px rgba(0, 0, 0, 0.25);
      --shadow-level-3: 0 8px 32px rgba(0, 0, 0, 0.35);
      --shadow-level-4: 0 12px 48px rgba(0, 0, 0, 0.45);
      
      /* Radius System */
      --radius-xs: 4px;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      --radius-full: 9999px;
      
      /* Spacing System */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      
      /* Animation System */
      --transition-speed-fast: 150ms;
      --transition-speed-normal: 250ms;
      --transition-speed-slow: 350ms;
      --transition-easing-standard: cubic-bezier(0.4, 0, 0.2, 1);
      --transition-easing-in: cubic-bezier(0.4, 0, 1, 1);
      --transition-easing-out: cubic-bezier(0, 0, 0.2, 1);
      
      /* Typography System */
      --font-family-primary: 'Tajawal', -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", sans-serif;
      --font-family-monospace: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace;
      
      --font-size-xs: 0.75rem;  /* 12px */
      --font-size-sm: 0.875rem; /* 14px */
      --font-size-md: 1rem;     /* 16px */
      --font-size-lg: 1.125rem; /* 18px */
      --font-size-xl: 1.25rem;  /* 20px */
      --font-size-2xl: 1.5rem;  /* 24px */
      
      --font-weight-regular: 400;
      --font-weight-medium: 500;
      --font-weight-semibold: 600;
      --font-weight-bold: 700;
      --font-weight-extrabold: 800;
      
      /* Z-Index System */
      --z-index-base: 1;
      --z-index-content: 10;
      --z-index-navigation: 50;
      --z-index-overlay: 100;
      --z-index-modal: 200;
      --z-index-toast: 300;
      --z-index-tooltip: 400;
      
      /* Breakpoint System */
      --breakpoint-xs: 0;
      --breakpoint-sm: 640px;
      --breakpoint-md: 768px;
      --breakpoint-lg: 1024px;
      --breakpoint-xl: 1280px;
      --breakpoint-2xl: 1536px;
      
      /* Performance Optimizations */
      --skeleton-gradient: linear-gradient(90deg, var(--color-bg-secondary), var(--color-bg-tertiary), var(--color-bg-secondary));
      
      /* Animation Durations */
      --animation-duration-fast: 0.2s;
      --animation-duration-normal: 0.3s;
      --animation-duration-slow: 0.5s;
      
      /* Custom Properties for Performance */
      --touch-target-size: 48px;
      --header-height: 72px;
      --footer-height: 100px;
      
      /* Environment-aware properties */
      color-scheme: dark;
    }

    /* ============================================
       Motion & Animation System
       ============================================ */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInScale {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-4px); }
    }

    /* ============================================
       Base & Reset with Performance Focus
       ============================================ */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-size-adjust: 100%;
      overflow-x: hidden;
    }

    body {
      font-family: var(--font-family-primary);
      background: 
        radial-gradient(1200px 600px at 70% 10%, rgba(90, 159, 255, 0.18), transparent),
        radial-gradient(900px 500px at 10% 30%, rgba(180, 110, 255, 0.15), transparent),
        var(--color-bg-primary);
      color: var(--color-text-primary);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
      position: relative;
      text-rendering: optimizeLegibility;
      font-feature-settings: "liga", "clig", "dlig" 1;
    }

    /* ============================================
       Accessibility & Touch Optimization
       ============================================ */
    [aria-hidden="true"] {
      display: none;
    }

    :focus-visible {
      outline: 2px solid var(--color-accent-primary);
      outline-offset: 2px;
    }

    [aria-disabled="true"] {
      opacity: 0.7;
      cursor: not-allowed;
      pointer-events: none;
    }

    /* Touch target sizing */
    .touch-target {
      min-height: var(--touch-target-size);
      min-width: var(--touch-target-size);
    }

    /* ============================================
       Layout System - Production Grade
       ============================================ */
    .app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
      isolation: isolate;
    }

    .app-header {
      position: sticky;
      top: 0;
      z-index: var(--z-index-navigation);
      border-bottom: 1px solid var(--color-border-primary);
      background: var(--color-bg-overlay);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      box-shadow: var(--shadow-level-2);
      height: var(--header-height);
    }

    .app-main {
      flex: 1;
      padding: var(--space-6) 0;
      position: relative;
      z-index: var(--z-index-content);
    }

    .app-footer {
      z-index: var(--z-index-navigation);
      border-top: 1px solid var(--color-border-primary);
      background: var(--color-bg-overlay);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      padding: var(--space-6) 0 var(--space-8);
    }

    .container {
      width: 100%;
      max-width: 1440px;
      margin: 0 auto;
      padding: 0 var(--space-4);
    }

    /* ============================================
       Header Component - Professional Design
       ============================================ */
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 100%;
    }

    .header-brand {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      text-decoration: none;
    }

    .header-logo {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--color-accent-primary), var(--color-accent-primary-light));
      border-radius: var(--radius-xl);
      font-size: 1.5rem;
      font-weight: var(--font-weight-bold);
      color: white;
      box-shadow: 0 4px 16px rgba(90, 159, 255, 0.4);
      flex-shrink: 0;
      transition: transform var(--transition-speed-fast) var(--transition-easing-out);
    }

    .header-brand:hover .header-logo {
      transform: scale(1.05);
    }

    .header-text {
      display: flex;
      flex-direction: column;
      gap: var(--space-1);
    }

    .header-title {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-extrabold);
      letter-spacing: -0.02em;
      color: var(--color-text-primary);
      line-height: 1.2;
    }

    .header-subtitle {
      font-size: var(--font-size-xs);
      color: var(--color-text-secondary);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-weight: var(--font-weight-medium);
      opacity: 0.9;
    }

    /* ============================================
       Filters Panel - Enterprise UX
       ============================================ */
    .filters-section {
      background: rgba(18, 27, 47, 0.92);
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-lg);
      padding: var(--space-5);
      margin-bottom: var(--space-6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: var(--shadow-level-2);
      transition: all var(--transition-speed-normal) var(--transition-easing-standard);
    }

    .filters-section:hover {
      border-color: var(--color-border-accent);
      box-shadow: var(--shadow-level-3);
    }

    .filters-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: var(--space-4);
      align-items: flex-end;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .form-label {
      font-size: var(--font-size-xs);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-secondary);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .form-label::before {
      content: "";
      display: inline-block;
      width: 4px;
      height: 4px;
      border-radius: var(--radius-full);
      background: var(--color-accent-primary);
    }

    .form-input,
    .form-select {
      padding: var(--space-2) var(--space-3);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border-secondary);
      background: rgba(11, 18, 32, 0.6);
      color: var(--color-text-primary);
      font-size: var(--font-size-md);
      font-family: inherit;
      outline: none;
      transition: all var(--transition-speed-fast) var(--transition-easing-standard);
      width: 100%;
      height: 48px;
      appearance: none;
    }

    .form-input::placeholder {
      color: var(--color-text-tertiary);
      opacity: 0.8;
    }

    .form-input:focus,
    .form-select:focus {
      border-color: var(--color-accent-primary);
      background: rgba(11, 18, 32, 0.8);
      box-shadow: 0 0 0 3px rgba(90, 159, 255, 0.2);
      z-index: 1;
    }

    .form-select {
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%23a8b8d9' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: left var(--space-3) center;
      padding-right: var(--space-6);
      padding-left: calc(var(--space-6) + 20px);
    }

    .filter-meta {
      display: flex;
      gap: var(--space-3);
      align-items: flex-end;
      justify-content: flex-end;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: var(--space-1);
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      min-width: 140px;
      text-align: right;
      transition: color var(--transition-speed-fast);
    }

    .status-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: var(--radius-full);
      background: var(--color-status-info);
      flex-shrink: 0;
    }

    .status-dot.success {
      background: var(--color-status-success);
      box-shadow: 0 0 8px rgba(61, 220, 151, 0.5);
    }

    .status-dot.error {
      background: var(--color-status-error);
      box-shadow: 0 0 8px rgba(255, 107, 114, 0.5);
    }

    .status-dot.loading {
      background: var(--color-status-warning);
      animation: pulse 1.5s infinite;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-md);
      font-weight: var(--font-weight-bold);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-speed-fast) var(--transition-easing-standard);
      text-decoration: none;
      white-space: nowrap;
      touch-action: manipulation;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-accent-primary), var(--color-accent-primary-light));
      border: none;
      color: white;
      box-shadow: 0 4px 16px rgba(90, 159, 255, 0.3);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(90, 159, 255, 0.45);
      background: linear-gradient(135deg, var(--color-accent-primary-light), #8ec8ff);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(90, 159, 255, 0.3);
    }

    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    /* ============================================
       Grid System - Responsive & Performant
       ============================================ */
    .lessons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: var(--space-5);
      opacity: 0;
      transform: translateY(16px);
      animation: fadeInUp var(--animation-duration-normal) forwards;
    }

    .grid-item {
      animation: fadeIn var(--animation-duration-normal) ease-out;
      animation-fill-mode: both;
    }

    @media (max-width: 1024px) {
      .lessons-grid {
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      }
    }

    @media (max-width: 640px) {
      .lessons-grid {
        grid-template-columns: 1fr;
      }
      .filters-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ============================================
       Lesson Card - Professional Component
       ============================================ */
    .lesson-card {
      display: flex;
      flex-direction: column;
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-lg);
      overflow: hidden;
      transition: all var(--transition-speed-normal) var(--transition-easing-standard);
      box-shadow: var(--shadow-level-2);
      height: 100%;
      position: relative;
      isolation: isolate;
    }

    .lesson-card:hover {
      border-color: var(--color-accent-primary);
      box-shadow: var(--shadow-level-3);
      transform: translateY(-4px);
      background: var(--color-bg-tertiary);
      z-index: 1;
    }

    .lesson-card:active {
      transform: translateY(0);
    }

    .card-hover-area {
      position: absolute;
      inset: 0;
      z-index: 1;
    }

    .lesson-header {
      padding: var(--space-4);
      border-bottom: 1px solid var(--color-border-secondary);
      background: linear-gradient(135deg, rgba(90, 159, 255, 0.08), rgba(109, 226, 179, 0.08));
    }

    .lesson-title {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-2);
      line-height: 1.4;
      word-break: break-word;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .lesson-meta {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-2);
      font-size: var(--font-size-sm);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: var(--space-1) var(--space-2);
      border-radius: var(--radius-full);
      font-weight: var(--font-weight-medium);
      font-size: var(--font-size-xs);
      white-space: nowrap;
      transition: all var(--transition-speed-fast);
    }

    .badge-category {
      background: rgba(109, 226, 179, 0.15);
      border: 1px solid rgba(109, 226, 179, 0.3);
      color: var(--color-accent-secondary);
    }

    .badge-date {
      background: rgba(255, 184, 77, 0.15);
      border: 1px solid rgba(255, 184, 77, 0.3);
      color: var(--color-accent-tertiary);
    }

    .badge-id {
      background: rgba(90, 159, 255, 0.15);
      border: 1px solid rgba(90, 159, 255, 0.3);
      color: var(--color-accent-primary-light);
    }

    /* ============================================
       Media Thumbnail - Professional Implementation
       ============================================ */
    .lesson-thumbnail {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #000;
      overflow: hidden;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .thumbnail-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform var(--transition-speed-normal) var(--transition-easing-standard);
      will-change: transform;
    }

    .lesson-card:hover .thumbnail-image {
      transform: scale(1.08);
    }

    .thumbnail-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.6));
      transition: background var(--transition-speed-normal) var(--transition-easing-standard);
      cursor: pointer;
      opacity: 0;
      transition: opacity var(--transition-speed-fast) var(--transition-easing-standard);
    }

    .lesson-card:hover .thumbnail-overlay {
      opacity: 1;
      background: rgba(0, 0, 0, 0.4);
    }

    .play-button {
      width: 72px;
      height: 72px;
      border-radius: var(--radius-full);
      background: linear-gradient(135deg, var(--color-accent-primary), var(--color-accent-primary-light));
      border: 3px solid rgba(255, 255, 255, 0.92);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 28px rgba(90, 159, 255, 0.5);
      transition: all var(--transition-speed-fast) var(--transition-easing-standard);
      position: relative;
      z-index: 2;
    }

    .lesson-card:hover .play-button {
      transform: scale(1.1);
      box-shadow: 0 12px 36px rgba(90, 159, 255, 0.65);
    }

    .play-icon {
      width: 0;
      height: 0;
      border-left: 20px solid white;
      border-top: 12px solid transparent;
      border-bottom: 12px solid transparent;
      margin-left: 2px;
    }

    .thumbnail-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--color-bg-tertiary), var(--color-bg-secondary));
      color: var(--color-text-tertiary);
      font-size: 2rem;
    }

    /* ============================================
       Actions Bar - Enhanced UX
       ============================================ */
    .lesson-actions {
      padding: var(--space-3);
      display: flex;
      gap: var(--space-2);
      flex-wrap: wrap;
      margin-top: auto;
      border-top: 1px solid var(--color-border-secondary);
      background: rgba(0, 0, 0, 0.1);
    }

    .action-btn,
    .action-link {
      flex: 1;
      min-width: 110px;
      padding: var(--space-2) 0;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border-secondary);
      background: rgba(255, 255, 255, 0.08);
      color: var(--color-text-primary);
      font-size: var(--font-size-sm);
      font-weight: var(--font-weight-bold);
      text-decoration: none;
      cursor: pointer;
      font-family: inherit;
      white-space: nowrap;
      transition: all var(--transition-speed-fast) var(--transition-easing-standard);
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-1);
    }

    .action-btn:active,
    .action-link:active {
      transform: scale(0.97);
      background: rgba(255, 255, 255, 0.12);
    }

    .btn-watch {
      background: linear-gradient(135deg, rgba(90, 159, 255, 0.3), rgba(90, 159, 255, 0.15));
      border-color: rgba(90, 159, 255, 0.4);
      color: var(--color-accent-primary-light);
    }

    .btn-watch:hover {
      background: linear-gradient(135deg, rgba(90, 159, 255, 0.4), rgba(90, 159, 255, 0.25));
    }

    .btn-download {
      background: rgba(109, 226, 179, 0.15);
      border-color: rgba(109, 226, 179, 0.4);
      color: var(--color-accent-secondary-dark);
    }

    .btn-download:hover {
      background: rgba(109, 226, 179, 0.25);
    }

    /* ============================================
       Modal System - Production Quality
       ============================================ */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: var(--z-index-modal);
      opacity: 0;
      transform: scale(0.95);
      transition: all var(--transition-speed-normal) var(--transition-easing-standard);
      pointer-events: none;
    }

    .modal-overlay.open {
      opacity: 1;
      transform: scale(1);
      pointer-events: all;
    }

    .modal-content {
      background: var(--color-bg-secondary);
      border-radius: var(--radius-xl);
      border: 1px solid var(--color-border-secondary);
      box-shadow: var(--shadow-level-4);
      width: 95%;
      max-width: 1000px;
      height: 85vh;
      display: flex;
      flex-direction: column;
      opacity: 0;
      transform: translateY(20px);
      transition: all var(--transition-speed-normal) var(--transition-easing-standard);
      overflow: hidden;
    }

    .modal-overlay.open .modal-content {
      opacity: 1;
      transform: translateY(0);
    }

    .modal-header {
      padding: var(--space-4) var(--space-5);
      border-bottom: 1px solid var(--color-border-secondary);
      display: flex;
      align-items: center;
      gap: var(--space-3);
      background: rgba(11, 18, 32, 0.95);
    }

    .modal-title {
      flex: 1;
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .modal-close {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid var(--color-border-secondary);
      color: var(--color-text-primary);
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-speed-fast);
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: rotate(90deg);
    }

    .modal-body {
      flex: 1;
      position: relative;
      background: #000;
    }

    .media-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      position: relative;
    }

    .media-element {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }

    .loading-indicator {
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      color: var(--color-text-secondary);
      font-size: var(--font-size-md);
      background: rgba(0, 0, 0, 0.7);
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-lg);
      backdrop-filter: blur(4px);
    }

    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(90, 159, 255, 0.3);
      border-top-color: var(--color-accent-primary);
      border-radius: var(--radius-full);
      animation: spin 0.8s linear infinite;
    }

    /* ============================================
       Empty & Loading States - Professional UX
       ============================================ */
    .empty-state {
      grid-column: 1 / -1;
      padding: var(--space-8) var(--space-4);
      text-align: center;
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-lg);
      animation: fadeIn var(--animation-duration-normal);
    }

    .empty-icon {
      font-size: 4rem;
      margin-bottom: var(--space-4);
      opacity: 0.6;
      color: var(--color-text-tertiary);
    }

    .empty-title {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      margin-bottom: var(--space-2);
    }

    .empty-text {
      font-size: var(--font-size-lg);
      color: var(--color-text-secondary);
      max-width: 600px;
      margin: 0 auto;
      line-height: 1.6;
    }

    .skeleton-card {
      background: var(--color-bg-secondary);
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-lg);
      overflow: hidden;
      height: 480px;
      position: relative;
      isolation: isolate;
    }

    .skeleton-header {
      padding: var(--space-4);
      border-bottom: 1px solid var(--color-border-secondary);
      height: 80px;
    }

    .skeleton-title {
      height: 24px;
      width: 60%;
      margin-bottom: var(--space-2);
      border-radius: var(--radius-xs);
    }

    .skeleton-meta {
      display: flex;
      gap: var(--space-2);
    }

    .skeleton-badge {
      height: 20px;
      width: 80px;
      border-radius: var(--radius-full);
    }

    .skeleton-thumbnail {
      height: 200px;
      background: var(--color-bg-tertiary);
    }

    .skeleton-actions {
      padding: var(--space-3);
      display: flex;
      gap: var(--space-2);
      height: 56px;
    }

    .skeleton-action {
      flex: 1;
      height: 40px;
      border-radius: var(--radius-md);
    }

    .skeleton {
      background: linear-gradient(90deg, var(--color-bg-tertiary), var(--color-bg-secondary), var(--color-bg-tertiary));
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    /* ============================================
       Toast System - Enterprise Notifications
       ============================================ */
    .toast-container {
      position: fixed;
      bottom: var(--space-6);
      left: 50%;
      transform: translateX(-50%);
      z-index: var(--z-index-toast);
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
      pointer-events: none;
    }

    .toast {
      background: var(--color-bg-overlay);
      border: 1px solid var(--color-border-secondary);
      border-radius: var(--radius-lg);
      padding: var(--space-3) var(--space-4);
      box-shadow: var(--shadow-level-3);
      color: var(--color-text-primary);
      font-size: var(--font-size-md);
      font-weight: var(--font-weight-medium);
      display: flex;
      align-items: center;
      gap: var(--space-2);
      pointer-events: all;
      transform: translateY(100px);
      opacity: 0;
      transition: all var(--transition-speed-normal) var(--transition-easing-standard);
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast.hide {
      opacity: 0;
      transform: translateY(20px);
    }

    .toast-success {
      border-color: rgba(61, 220, 151, 0.3);
      background: linear-gradient(90deg, rgba(11, 18, 32, 0.95), rgba(61, 220, 151, 0.1));
    }

    .toast-error {
      border-color: rgba(255, 107, 114, 0.3);
      background: linear-gradient(90deg, rgba(11, 18, 32, 0.95), rgba(255, 107, 114, 0.1));
    }

    .toast-icon {
      font-size: 1.25rem;
      flex-shrink: 0;
    }

    /* ============================================
       Footer - Professional Design
       ============================================ */
    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: var(--space-4);
    }

    .footer-author {
      display: flex;
      flex-direction: column;
      gap: var(--space-1);
    }

    .footer-name {
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-bold);
      color: var(--color-text-primary);
      letter-spacing: -0.5px;
    }

    .footer-role {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-weight: var(--font-weight-medium);
    }

    .footer-social {
      display: flex;
      gap: var(--space-2);
    }

    .social-link {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border-secondary);
      background: rgba(255, 255, 255, 0.08);
      color: var(--color-text-primary);
      text-decoration: none;
      transition: all var(--transition-speed-fast) var(--transition-easing-standard);
      font-size: 1.25rem;
    }

    .social-link:hover {
      background: rgba(90, 159, 255, 0.25);
      border-color: var(--color-accent-primary);
      color: var(--color-accent-primary-light);
      transform: translateY(-2px);
    }

    .social-link:active {
      transform: translateY(0);
    }

    .footer-divider {
      height: 1px;
      background: var(--color-border-primary);
      margin: var(--space-4) 0;
    }

    .footer-copyright {
      font-size: var(--font-size-sm);
      color: var(--color-text-secondary);
      text-align: center;
      padding-top: var(--space-3);
      font-weight: var(--font-weight-medium);
    }

    /* ============================================
       Responsive Design - Mobile First
       ============================================ */
    @media (max-width: 1024px) {
      .filters-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .header-title {
        font-size: var(--font-size-lg);
      }
      
      .filters-grid {
        grid-template-columns: 1fr;
        gap: var(--space-3);
      }
      
      .filter-meta {
        flex-direction: column;
        align-items: stretch;
      }
      
      .status-indicator {
        text-align: left;
        min-width: auto;
      }
    }

    @media (max-width: 640px) {
      .header-logo {
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
      }
      
      .header-title {
        font-size: var(--font-size-lg);
      }
      
      .header-subtitle {
        font-size: var(--font-size-xs);
      }
      
      .form-input,
      .form-select {
        height: 44px;
        font-size: var(--font-size-md);
      }
      
      .lesson-title {
        font-size: var(--font-size-md);
      }
      
      .play-button {
        width: 56px;
        height: 56px;
      }
      
      .play-icon {
        border-left-width: 16px;
        border-top-width: 10px;
        border-bottom-width: 10px;
      }
      
      .modal-title {
        font-size: var(--font-size-lg);
      }
      
      .footer-content {
        flex-direction: column;
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 0 var(--space-3);
      }
      
      .filters-section {
        padding: var(--space-4);
        margin-bottom: var(--space-4);
      }
      
      .action-btn,
      .action-link {
        min-width: 90px;
        padding: var(--space-2) 0;
        font-size: var(--font-size-sm);
      }
      
      .empty-title {
        font-size: var(--font-size-xl);
      }
      
      .empty-text {
        font-size: var(--font-size-md);
      }
    }

    /* ============================================
       Performance Optimizations
       ============================================ */
    /* Lazy loading optimization */
    .lazy-load {
      opacity: 0;
      transition: opacity var(--transition-speed-normal);
    }

    .lazy-load.loaded {
      opacity: 1;
    }

    /* Reduce motion for users who prefer it */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      
      .lesson-card:hover .thumbnail-image {
        transform: none;
      }
      
      .lesson-card:hover .play-button {
        transform: none;
      }
    }

    /* Print styles */
    @media print {
      .app-header, .filters-section, .lesson-actions, .app-footer {
        display: none;
      }
      
      .app-main {
        padding: 0;
      }
      
      .lesson-card {
        break-inside: avoid;
        page-break-inside: avoid;
      }
      
      .lesson-thumbnail {
        height: 200px;
      }
    }

    /* ============================================
       Accessibility Improvements
       ============================================ */
    [aria-current="page"] {
      position: relative;
    }

    [aria-current="page"]::after {
      content: "";
      position: absolute;
      bottom: -4px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--color-accent-primary);
      border-radius: var(--radius-xs);
    }

    /* Focus ring improvements */
    *:focus-visible {
      outline: 2px solid var(--color-accent-primary);
      outline-offset: 2px;
      box-shadow: 0 0 0 2px rgba(90, 159, 255, 0.3);
    }

    /* Reduced data usage mode */
    @media (prefers-reduced-data: reduce) {
      .thumbnail-image {
        content-visibility: auto;
      }
    }

    /* ============================================
       Loading Optimizations
       ============================================ */
    .page-loader {
      position: fixed;
      inset: 0;
      background: var(--color-bg-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity var(--transition-speed-normal) var(--transition-easing-standard);
    }

    .loader-content {
      text-align: center;
      animation: fadeInScale var(--animation-duration-normal);
    }

    .loader-logo {
      font-size: 3rem;
      margin-bottom: var(--space-4);
      color: var(--color-accent-primary);
      animation: bounce 1.5s infinite;
    }

    .loader-text {
      font-size: var(--font-size-lg);
      color: var(--color-text-secondary);
      margin-bottom: var(--space-2);
    }

    .loader-progress {
      width: 200px;
      height: 4px;
      background: var(--color-border-secondary);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin: 0 auto;
    }

    .loader-progress-bar {
      height: 100%;
      background: var(--color-accent-primary);
      width: 0%;
      transition: width var(--transition-speed-slow) ease-in-out;
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <!-- Page Loader - Professional UX -->
  <div class="page-loader" id="pageLoader">
    <div class="loader-content">
      <div class="loader-logo">üìö</div>
      <div class="loader-text">ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä...</div>
      <div class="loader-progress">
        <div class="loader-progress-bar" id="progressBar"></div>
      </div>
    </div>
  </div>

  <div class="app-container">
    <!-- Header - Professional Navigation -->
    <header class="app-header">
      <div class="container header-content">
        <a href="#" class="header-brand" aria-label="ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©">
          <div class="header-logo">üìö</div>
          <div class="header-text">
            <div class="header-title">ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿØÿ±Ÿàÿ≥ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ©</div>
            <div class="header-subtitle">ŸÖŸÜÿµÿ© ÿ™ÿπŸÑŸäŸÖŸäÿ© ÿ¥ÿßŸÖŸÑÿ©</div>
          </div>
        </a>
      </div>
    </header>

    <!-- Main Content - Enterprise Layout -->
    <main class="app-main">
      <div class="container">
        <!-- Filters Panel - Advanced UX -->
        <section class="filters-section">
          <div class="filters-grid">
            <div class="form-group">
              <label for="searchInput" class="form-label">ÿ®ÿ≠ÿ´ ŸÖÿ™ŸÇÿØŸÖ</label>
              <input
                id="searchInput"
                type="search"
                class="form-input"
                placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿØÿ±ÿ≥ÿå ŸÖŸàÿ∂Ÿàÿπÿå ÿ£Ÿà ÿ™ÿßÿ±ŸäÿÆ..."
                autocomplete="off"
                aria-label="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖŸÉÿ™ÿ®ÿ©"
              >
            </div>
            
            <div class="form-group">
              <label for="categorySelect" class="form-label">ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™</label>
              <select id="categorySelect" class="form-select" aria-label="ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ™ÿµŸÜŸäŸÅ">
                <option value="loading">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="timeSelect" class="form-label">ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ</label>
              <select id="timeSelect" class="form-select" aria-label="ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©">
                <option value="all">ÿ¨ŸÖŸäÿπ ÿßŸÑŸÅÿ™ÿ±ÿßÿ™</option>
                <option value="today">ÿßŸÑŸäŸàŸÖ</option>
                <option value="yesterday">ÿ£ŸÖÿ≥</option>
                <option value="week">ÿ¢ÿÆÿ± ÿ£ÿ≥ÿ®Ÿàÿπ</option>
                <option value="month">ÿ¢ÿÆÿ± ÿ¥Ÿáÿ±</option>
                <option value="year">ÿ¢ÿÆÿ± ÿ≥ŸÜÿ©</option>
              </select>
            </div>
            
            <div class="filter-meta">
              <div class="status-indicator">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿ∂Ÿäÿ±...</span>
              </div>
              <button id="refreshBtn" class="btn btn-primary touch-target" aria-label="ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™">
                <span>‚ü≥</span>
                <span>ÿ™ÿ≠ÿØŸäÿ´</span>
              </button>
            </div>
          </div>
        </section>

        <!-- Lessons Grid - Professional Layout -->
        <section aria-label="ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿØÿ±Ÿàÿ≥" id="lessonsSection">
          <div class="lessons-grid" id="lessonsGrid">
            <!-- Skeleton loading states for better UX -->
            <div class="grid-item skeleton-card">
              <div class="skeleton-header">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton-meta">
                  <div class="skeleton skeleton-badge"></div>
                  <div class="skeleton skeleton-badge"></div>
                </div>
              </div>
              <div class="skeleton-thumbnail skeleton"></div>
              <div class="skeleton-actions">
                <div class="skeleton skeleton-action"></div>
                <div class="skeleton skeleton-action"></div>
              </div>
            </div>
            <div class="grid-item skeleton-card">
              <div class="skeleton-header">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton-meta">
                  <div class="skeleton skeleton-badge"></div>
                  <div class="skeleton skeleton-badge"></div>
                </div>
              </div>
              <div class="skeleton-thumbnail skeleton"></div>
              <div class="skeleton-actions">
                <div class="skeleton skeleton-action"></div>
                <div class="skeleton skeleton-action"></div>
              </div>
            </div>
            <div class="grid-item skeleton-card">
              <div class="skeleton-header">
                <div class="skeleton skeleton-title"></div>
                <div class="skeleton-meta">
                  <div class="skeleton skeleton-badge"></div>
                  <div class="skeleton skeleton-badge"></div>
                </div>
              </div>
              <div class="skeleton-thumbnail skeleton"></div>
              <div class="skeleton-actions">
                <div class="skeleton skeleton-action"></div>
                <div class="skeleton skeleton-action"></div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Player Modal - Enterprise Media Player -->
    <div class="modal-overlay" id="playerModal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content">
        <header class="modal-header">
          <h2 class="modal-title" id="playerTitle">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</h2>
          <button class="modal-close" id="closePlayerBtn" aria-label="ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖÿ¥ÿ∫ŸÑ">
            <span>√ó</span>
          </button>
        </header>
        <div class="modal-body">
          <div class="media-container">
            <div class="loading-indicator">
              <div class="spinner"></div>
              <span>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ...</span>
            </div>
            <div id="mediaContent"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notifications - Professional Feedback System -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Footer - Professional Attribution -->
    <footer class="app-footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-author">
            <div class="footer-name">Hayl Al-Khadhami</div>
            <div class="footer-role">Engineer | Researcher | Educator</div>
          </div>
          <div class="footer-social">
            <a href="https://www.linkedin.com/in/halkhadhami/" target="_blank" rel="noopener" class="social-link" aria-label="LinkedIn">
              <span>in</span>
            </a>
            <a href="https://github.com/halkhadhami" target="_blank" rel="noopener" class="social-link" aria-label="GitHub">
              <span>@</span>
            </a>
          </div>
        </div>
        <div class="footer-divider"></div>
        <div class="footer-copyright">
          <p>&copy; 2026 Hayl Al-Khadhami | ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ©</p>
        </div>
      </div>
    </footer>
  </div>

  <script>
    /**
     * ================================================
     * ENTERPRISE-GRADE APPLICATION ARCHITECTURE
     * Production-ready educational platform
     * ================================================
     */
    
    // ========================
    // APPLICATION CORE - Enterprise Architecture
    // ========================
    
    /**
     * Application State Management
     * @type {Object}
     */
    const AppState = {
      lessons: [],
      filteredLessons: [],
      isLoading: true,
      cache: null,
      cacheTimestamp: 0,
      error: null,
      initialized: false,
      offlineMode: false
    };
    
    /**
     * Configuration System
     * @type {Object}
     */
    const AppConfig = {
      SHEET_CSV_URL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTLx7eaIKwI4yVGNE84i_btsnqMDmQZwC7bQFkMyUiuMqo4nGyC-K7Jq0fYZ7TULPZi4JUv1RnqEkwr/pub?output=csv",
      CACHE_DURATION: 3600000, // 1 hour in milliseconds
      FETCH_TIMEOUT: 10000, // 10 seconds
      MAX_CONCURRENT_REQUESTS: 3,
      LAZY_LOAD_THRESHOLD: "0px 0px 200px 0px",
      CATEGORIES: {
        "Arabic": "ÿπÿ±ÿ®Ÿä",
        "Art": "ŸÅŸÜ",
        "Chinese": "ÿµŸäŸÜŸä", 
        "English": "ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿä",
        "Fun": "ÿ™ÿ±ŸÅŸäŸá",
        "Islamic": "ÿ•ÿ≥ŸÑÿßŸÖŸäÿßÿ™", 
        "Kuran": "ŸÇÿ±ÿ¢ŸÜ",
        "Math": "ÿ±Ÿäÿßÿ∂Ÿäÿßÿ™",
        "Other": "ÿ£ÿÆÿ±Ÿâ"
      },
      CATEGORY_ORDER: ["Arabic", "Art", "Chinese", "English", "Fun", "Islamic", "Kuran", "Math", "Other"],
      PRIORITY_CATEGORIES: ["Arabic", "Math", "English"],
      MAX_LESSONS_DISPLAY: 100,
      TOAST_DURATION: 3000,
      PROGRESS_STEPS: [20, 40, 60, 80, 100]
    };
    
    /**
     * DOM References - Performance Optimized
     * @type {Object}
     */
    const DOMElements = {
      pageLoader: document.getElementById('pageLoader'),
      progressBar: document.getElementById('progressBar'),
      lessonsGrid: document.getElementById('lessonsGrid'),
      searchInput: document.getElementById('searchInput'),
      categorySelect: document.getElementById('categorySelect'),
      timeSelect: document.getElementById('timeSelect'),
      refreshBtn: document.getElementById('refreshBtn'),
      statusText: document.getElementById('statusText'),
      statusDot: document.getElementById('statusDot'),
      playerModal: document.getElementById('playerModal'),
      playerTitle: document.getElementById('playerTitle'),
      mediaContent: document.getElementById('mediaContent'),
      closePlayerBtn: document.getElementById('closePlayerBtn'),
      toastContainer: document.getElementById('toastContainer'),
      lessonsSection: document.getElementById('lessonsSection')
    };
    
    // ========================
    // UTILITY SYSTEMS - Production Grade
    // ========================
    
    /**
     * Utility Functions Collection
     */
    const Utils = {
      /**
       * Parse CSV data with robust error handling
       * @param {string} text - CSV text content
       * @returns {Array<Array<string>>} Parsed CSV data
       */
      parseCSV: function(text) {
        try {
          const rows = [];
          let currentRow = [];
          let currentCell = '';
          let inQuotes = false;
          let escapeNext = false;
          
          for (let i = 0; i < text.length; i++) {
            const char = text[i];
            const nextChar = text[i + 1] || '';
            
            // Handle escaped quotes
            if (escapeNext) {
              currentCell += char;
              escapeNext = false;
              continue;
            }
            
            // Handle quotes
            if (char === '"' && !escapeNext) {
              if (inQuotes && nextChar === '"') {
                // Escaped quote within quotes
                currentCell += '"';
                i++; // Skip next quote
                continue;
              }
              inQuotes = !inQuotes;
              continue;
            }
            
            // Handle cell separators
            if (!inQuotes && char === ',') {
              currentRow.push(currentCell.trim());
              currentCell = '';
              continue;
            }
            
            // Handle row separators
            if (!inQuotes && (char === '\n' || char === '\r')) {
              currentRow.push(currentCell.trim());
              if (currentRow.some(cell => cell !== '')) {
                rows.push(currentRow);
              }
              currentRow = [];
              currentCell = '';
              if (char === '\r' && nextChar === '\n') {
                i++; // Skip next character if CRLF
              }
              continue;
            }
            
            currentCell += char;
          }
          
          // Handle last cell/row
          if (currentCell || currentRow.length > 0) {
            currentRow.push(currentCell.trim());
            if (currentRow.some(cell => cell !== '')) {
              rows.push(currentRow);
            }
          }
          
          return rows;
        } catch (error) {
          console.error('CSV parsing error:', error);
          throw new Error('ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ÿØŸàŸÑ');
        }
      },
      
      /**
       * Parse date from DD/MM/YYYY format with validation
       * @param {string} dateStr - Date string in DD/MM/YYYY format
       * @returns {Date|null} Parsed date or null if invalid
       */
      parseDate: function(dateStr) {
        if (!dateStr || typeof dateStr !== 'string') return null;
        
        const parts = dateStr.trim().split('/');
        if (parts.length !== 3) return null;
        
        const [day, month, year] = parts.map(part => parseInt(part, 10));
        
        // Validate date components
        if (
          isNaN(day) || isNaN(month) || isNaN(year) ||
          day < 1 || day > 31 ||
          month < 1 || month > 12 ||
          year < 1900 || year > 2100
        ) {
          return null;
        }
        
        // Create date with midday time to avoid timezone issues
        return new Date(year, month - 1, day, 12, 0, 0);
      },
      
      /**
       * Format date for Arabic display
       * @param {Date} date - Date object to format
       * @returns {string} Formatted date string
       */
      formatDateArabic: function(date) {
        if (!date || !(date instanceof Date) || isNaN(date)) {
          return '‚Äî';
        }
        
        try {
          return new Intl.DateTimeFormat('ar-EG', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            timeZone: 'UTC'
          }).format(date);
        } catch (error) {
          console.warn('Date formatting fallback:', error);
          return date.toLocaleDateString('ar-EG');
        }
      },
      
      /**
       * Calculate days between two dates
       * @param {Date} date1 - First date
       * @param {Date} date2 - Second date
       * @returns {number} Number of days between dates
       */
      daysBetween: function(date1, date2) {
        if (!date1 || !date2) return Infinity;
        
        // Normalize to UTC dates to avoid timezone issues
        const utc1 = Date.UTC(date1.getFullYear(), date1.getMonth(), date1.getDate());
        const utc2 = Date.UTC(date2.getFullYear(), date2.getMonth(), date2.getDate());
        
        return Math.floor((utc1 - utc2) / 86400000);
      },
      
      /**
       * Escape HTML special characters for security
       * @param {string} str - String to escape
       * @returns {string} Escaped string
       */
      escapeHtml: function(str) {
        if (!str || typeof str !== 'string') return '';
        
        const escapeMap = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;'
        };
        
        return str.replace(/[&<>"']/g, char => escapeMap[char] || char);
      },
      
      /**
       * Extract YouTube video ID from URL
       * @param {string} url - YouTube URL
       * @returns {string|null} Video ID or null
       */
      extractYouTubeId: function(url) {
        if (!url || typeof url !== 'string') return null;
        
        const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
        const match = url.match(regex);
        return match ? match[1] : null;
      },
      
      /**
       * Extract Google Drive file ID from URL
       * @param {string} url - Google Drive URL
       * @returns {string|null} File ID or null
       */
      extractDriveId: function(url) {
        if (!url || typeof url !== 'string') return null;
        
        const patterns = [
          /\/file\/d\/([^\/\?#]+)/,
          /[?&]id=([^&]+)/,
          /\/d\/([^\/\?#]+)/,
          /\/open\?id=([^&]+)/
        ];
        
        for (const pattern of patterns) {
          const match = url.trim().match(pattern);
          if (match && match[1]) {
            return match[1].trim();
          }
        }
        
        return null;
      },
      
      /**
       * Determine content type from URL
       * @param {string} url - Content URL
       * @returns {string} Content type identifier
       */
      getContentType: function(url) {
        if (!url || typeof url !== 'string') return 'unknown';
        
        const urlLower = url.toLowerCase();
        const path = urlLower.split('?')[0];
        
        // Check for YouTube
        if (this.extractYouTubeId(url)) {
          return 'youtube';
        }
        
        // Check for Google Drive
        if (urlLower.includes('drive.google.com')) {
          return 'drive';
        }
        
        // Check file extensions
        if (/\.(mp4|webm|ogg|mov|m4v|mkv|avi|flv|wmv)$/i.test(path)) {
          return 'video';
        }
        
        if (/\.(pdf)$/i.test(path)) {
          return 'pdf';
        }
        
        if (/\.(png|jpg|jpeg|gif|webp|bmp|svg)$/i.test(path)) {
          return 'image';
        }
        
        return 'link';
      },
      
      /**
       * Generate Google Drive links
       * @param {string} url - Original Google Drive URL
       * @returns {Object|null} Object with various Drive links
       */
      getDriveLinks: function(url) {
        const id = this.extractDriveId(url);
        if (!id) return null;
        
        return {
          id: id,
          preview: `https://drive.google.com/file/d/${id}/preview`,
          download: `https://drive.google.com/uc?export=download&id=${id}`,
          view: `https://drive.google.com/uc?export=view&id=${id}`,
          thumb: `https://drive.google.com/thumbnail?id=${id}&sz=w640`
        };
      },
      
      /**
       * Debounce function for performance optimization
       * @param {Function} func - Function to debounce
       * @param {number} wait - Wait time in milliseconds
       * @returns {Function} Debounced function
       */
      debounce: function(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func.apply(this, args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      },
      
      /**
       * Throttle function for rate limiting
       * @param {Function} func - Function to throttle
       * @param {number} limit - Time limit in milliseconds
       * @returns {Function} Throttled function
       */
      throttle: function(func, limit) {
        let inThrottle;
        return function executedFunction(...args) {
          const context = this;
          if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
          }
        };
      },
      
      /**
       * Format bytes to human readable format
       * @param {number} bytes - Number of bytes
       * @returns {string} Formatted size string
       */
      formatBytes: function(bytes) {
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      },
      
      /**
       * Check if device is mobile
       * @returns {boolean} True if mobile device
       */
      isMobile: function() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      },
      
      /**
       * Check if device is touch capable
       * @returns {boolean} True if touch device
       */
      isTouchDevice: function() {
        return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      }
    };
    
    // ========================
    // DATA MANAGEMENT SYSTEM - Enterprise Grade
    // ========================
    
    /**
     * Data Management Service
     */
    const DataManager = {
      /**
       * Load lessons data from Google Sheets
       * @param {boolean} forceReload - Force reload ignoring cache
       * @returns {Promise<Array<Object>>} Array of lesson objects
       */
      async loadLessons(forceReload = false) {
        try {
          // Check cache first
          if (!forceReload && AppState.cache && Date.now() - AppState.cacheTimestamp < AppConfig.CACHE_DURATION) {
            AppState.lessons = [...AppState.cache];
            this.updateStatus('‚úì ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ŸÖŸÑÿ© ŸÖŸÜ ÿßŸÑÿ∞ÿßŸÉÿ±ÿ© ÿßŸÑŸÖÿ§ŸÇÿ™ÿ©', 'success');
            return AppState.lessons;
          }
          
          this.updateStatus('ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ©...', 'loading');
          AppState.isLoading = true;
          
          // Show loading progress
          this.simulateProgress();
          
          // Fetch data with timeout
          const response = await this.fetchWithTimeout(AppConfig.SHEET_CSV_URL, AppConfig.FETCH_TIMEOUT);
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const csvText = await response.text();
          
          // Parse CSV data
          const parsedData = Utils.parseCSV(csvText);
          if (parsedData.length < 2) {
            throw new Error('ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ÿØŸàŸÑ ŸÅÿßÿ±ÿ∫ÿ© ÿ£Ÿà ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠ÿ©');
          }
          
          // Process data
          const headers = parsedData[0].map(header => header.trim());
          const rawData = parsedData.slice(1);
          
          // Map to lesson objects
          const lessons = rawData
            .map(row => {
              const lessonObj = {};
              headers.forEach((header, index) => {
                lessonObj[header] = row[index] || '';
              });
              return this.normalizeLesson(lessonObj);
            })
            .filter(lesson => 
              lesson.title && 
              lesson.url && 
              lesson.title !== 'ÿ®ÿØŸàŸÜ ÿπŸÜŸàÿßŸÜ' &&
              !lesson.title.includes('error')
            );
          
          // Sort by date (newest first)
          lessons.sort((a, b) => {
            const dateA = a.date ? a.date.getTime() : 0;
            const dateB = b.date ? b.date.getTime() : 0;
            return dateB - dateA;
          });
          
          // Cache results
          AppState.cache = [...lessons];
          AppState.cacheTimestamp = Date.now();
          AppState.lessons = [...lessons];
          
          this.updateStatus(`‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ${lessons.length} ÿØÿ±ÿ≥ ÿ®ŸÜÿ¨ÿßÿ≠`, 'success');
          return lessons;
        } catch (error) {
          console.error('Data loading error:', error);
          
          // Try to use cached data if available
          if (AppState.cache && AppState.cache.length > 0) {
            this.updateStatus('‚ö† ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿÆÿ≤ŸÜÿ© ŸÖÿ§ŸÇÿ™ÿßŸã ÿ®ÿ≥ÿ®ÿ® ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ', 'warning');
            AppState.lessons = [...AppState.cache];
            return AppState.lessons;
          }
          
          this.updateStatus('‚ùå ÿ™ÿπÿ∞Ÿëÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'error');
          AppState.error = error.message || 'ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿπÿ±ŸàŸÅ';
          return [];
        } finally {
          AppState.isLoading = false;
          DOMElements.progressBar.style.width = '100%';
          setTimeout(() => {
            DOMElements.pageLoader.classList.add('hidden');
          }, 300);
        }
      },
      
      /**
       * Normalize lesson data structure
       * @param {Object} row - Raw row data from CSV
       * @returns {Object} Normalized lesson object
       */
      normalizeLesson: function(row) {
        const url = (row.ContentURL || '').trim();
        const contentType = Utils.getContentType(url);
        const driveLinks = contentType === 'drive' ? Utils.getDriveLinks(url) : null;
        const youtubeId = contentType === 'youtube' ? Utils.extractYouTubeId(url) : null;
        
        return {
          id: (row.LessonID || '').trim() || `lesson_${Math.random().toString(36).substr(2, 9)}`,
          title: (row.Title || '').trim() || 'ÿ®ÿØŸàŸÜ ÿπŸÜŸàÿßŸÜ',
          category: AppConfig.CATEGORY_ORDER.includes(row.Category) ? row.Category : 'Other',
          date: Utils.parseDate((row.DateUploaded || '').trim()),
          url: url,
          type: contentType,
          driveLinks: driveLinks,
          youtubeId: youtubeId,
          thumbnail: this.getThumbnailUrl(url, contentType, driveLinks, youtubeId),
          formattedDate: Utils.formatDateArabic(Utils.parseDate((row.DateUploaded || '').trim()))
        };
      },
      
      /**
       * Get appropriate thumbnail URL
       * @param {string} url - Content URL
       * @param {string} type - Content type
       * @param {Object} driveLinks - Google Drive links object
       * @param {string} youtubeId - YouTube video ID
       * @returns {string} Thumbnail URL
       */
      getThumbnailUrl: function(url, type, driveLinks, youtubeId) {
        switch(type) {
          case 'youtube':
            return youtubeId ? `https://i.ytimg.com/vi/${youtubeId}/hqdefault.jpg` : '';
          case 'drive':
            return driveLinks && driveLinks.thumb ? driveLinks.thumb : '';
          case 'image':
            return url;
          case 'video':
            return ''; // Will use placeholder
          case 'pdf':
            return 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="640" height="360" viewBox="0 0 640 360"%3E%3Crect width="640" height="360" fill="%231e293b"/%3E%3Cpath d="M150 100L250 100L250 200L150 200Z" fill="%234a90e2"/%3E%3Ccircle cx="300" cy="150" r="30" fill="%23ff9900"/%3E%3Ctext x="50%25" y="50%25" fill="%23ffffff" font-size="24" text-anchor="middle" dominant-baseline="middle"%3EPDF%3C/text%3E%3C/svg%3E';
          default:
            return 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="640" height="360" viewBox="0 0 640 360"%3E%3Crect width="640" height="360" fill="%231e293b"/%3E%3Cpath d="M320 100L420 200L320 300L220 200Z" fill="%234a90e2"/%3E%3Ctext x="50%25" y="50%25" fill="%23ffffff" font-size="24" text-anchor="middle" dominant-baseline="middle"%3EŸÖŸÑŸÅ%3C/text%3E%3C/svg%3E';
        }
      },
      
      /**
       * Filter lessons based on current criteria
       */
      filterLessons: function() {
        const searchTerm = DOMElements.searchInput.value.trim().toLowerCase();
        const category = DOMElements.categorySelect.value;
        const timeRange = DOMElements.timeSelect.value;
        const now = new Date();
        
        AppState.filteredLessons = AppState.lessons.filter(lesson => {
          // Search filter
          if (searchTerm && !lesson.title.toLowerCase().includes(searchTerm)) {
            return false;
          }
          
          // Category filter
          if (category !== 'all' && lesson.category !== category) {
            return false;
          }
          
          // Time filter
          if (timeRange !== 'all' && lesson.date) {
            const daysDiff = Utils.daysBetween(now, lesson.date);
            const filters = {
              'today': diff => diff === 0,
              'yesterday': diff => diff === 1,
              'week': diff => diff >= 0 && diff <= 7,
              'month': diff => diff >= 0 && diff <= 30,
              'year': diff => diff >= 0 && diff <= 365
            };
            
            if (!filters[timeRange] || !filters[timeRange](daysDiff)) {
              return false;
            }
          }
          
          return true;
        });
        
        this.renderLessons();
      },
      
      /**
       * Get unique categories from lessons
       * @returns {Array<string>} Array of unique categories
       */
      getUniqueCategories: function() {
        const categories = new Set();
        
        // Add priority categories first
        AppConfig.PRIORITY_CATEGORIES.forEach(cat => {
          if (AppState.lessons.some(lesson => lesson.category === cat)) {
            categories.add(cat);
          }
        });
        
        // Add remaining categories
        AppState.lessons.forEach(lesson => {
          if (!AppConfig.PRIORITY_CATEGORIES.includes(lesson.category)) {
            categories.add(lesson.category);
          }
        });
        
        return Array.from(categories);
      },
      
      /**
       * Simulate loading progress for better UX
       */
      simulateProgress: function() {
        let progress = 0;
        const interval = setInterval(() => {
          if (progress >= 100) {
            clearInterval(interval);
            return;
          }
          
          // Accelerate progress at the end
          const step = progress > 80 ? 5 : AppConfig.PROGRESS_STEPS[Math.floor(Math.random() * AppConfig.PROGRESS_STEPS.length)];
          progress = Math.min(100, progress + step);
          DOMElements.progressBar.style.width = `${progress}%`;
        }, 200);
      },
      
      /**
       * Update status indicator
       * @param {string} message - Status message
       * @param {string} type - Status type (success, error, warning, loading, idle)
       */
      updateStatus: function(message, type = 'idle') {
        DOMElements.statusText.textContent = message;
        
        // Update status dot
        DOMElements.statusDot.className = 'status-dot';
        switch(type) {
          case 'success':
            DOMElements.statusDot.classList.add('success');
            break;
          case 'error':
            DOMElements.statusDot.classList.add('error');
            break;
          case 'warning':
            DOMElements.statusDot.classList.add('warning');
            break;
          case 'loading':
            DOMElements.statusDot.classList.add('loading');
            break;
        }
      },
      
      /**
       * Fetch with timeout capability
       * @param {string} url - URL to fetch
       * @param {number} timeout - Timeout in milliseconds
       * @returns {Promise<Response>} Fetch response
       */
      fetchWithTimeout: function(url, timeout) {
        return new Promise((resolve, reject) => {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => {
            controller.abort();
            reject(new Error('ÿßŸÜÿ™Ÿáÿ™ ŸÖÿØÿ© ÿßŸÑÿ∑ŸÑÿ®'));
          }, timeout);
          
          fetch(url, {
            signal: controller.signal,
            cache: 'no-store',
            headers: {
              'Cache-Control': 'no-cache',
              'Pragma': 'no-cache'
            }
          })
          .then(response => {
            clearTimeout(timeoutId);
            resolve(response);
          })
          .catch(error => {
            clearTimeout(timeoutId);
            reject(error);
          });
        });
      }
    };
    
    // ========================
    // UI RENDERING SYSTEM - Professional UX
    // ========================
    
    /**
     * UI Rendering Service
     */
    const UIRenderer = {
      /**
       * Render category dropdown options
       * @param {Array<string>} categories - Array of category names
       */
      renderCategories: function(categories) {
        DOMElements.categorySelect.innerHTML = '';
        
        // Add "All" option
        const allOption = document.createElement('option');
        allOption.value = 'all';
        allOption.textContent = 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿßÿØ';
        DOMElements.categorySelect.appendChild(allOption);
        
        // Add category options
        categories.forEach(category => {
          const option = document.createElement('option');
          option.value = category;
          option.textContent = AppConfig.CATEGORIES[category] || category;
          DOMElements.categorySelect.appendChild(option);
        });
        
        // Set default selection
        DOMElements.categorySelect.value = 'all';
      },
      
      /**
       * Render lessons grid
       */
      renderLessons: function() {
        if (!AppState.initialized) return;
        
        const container = DOMElements.lessonsGrid;
        
        // Clear previous content but keep skeleton if loading
        if (AppState.isLoading) {
          return;
        }
        
        container.innerHTML = '';
        
        // Handle empty state
        if (AppState.filteredLessons.length === 0) {
          container.innerHTML = `
            <div class="grid-item empty-state" role="status" aria-live="polite">
              <div class="empty-icon">üì≠</div>
              <h3 class="empty-title">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨</h3>
              <p class="empty-text">ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿØÿ±Ÿàÿ≥ ÿ™ÿ∑ÿßÿ®ŸÇ ŸÖÿπÿßŸäŸäÿ± ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ≠ÿßŸÑŸäÿ©. ÿ¨ÿ±ÿ® ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿ£Ÿà ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ© ÿ£Ÿà ÿ•ÿ¨ÿ±ÿßÿ° ÿ®ÿ≠ÿ´ ŸÖÿÆÿ™ŸÑŸÅ.</p>
            </div>
          `;
          return;
        }
        
        // Create document fragment for better performance
        const fragment = document.createDocumentFragment();
        
        // Limit number of displayed lessons for performance
        const lessonsToDisplay = AppState.filteredLessons.slice(0, AppConfig.MAX_LESSONS_DISPLAY);
        
        lessonsToDisplay.forEach((lesson, index) => {
          const card = this.createLessonCard(lesson, index);
          fragment.appendChild(card);
        });
        
        container.appendChild(fragment);
        
        // Setup lazy loading
        this.setupLazyLoading();
      },
      
      /**
       * Create lesson card element
       * @param {Object} lesson - Lesson object
       * @param {number} index - Index for animation delay
       * @returns {HTMLElement} Lesson card element
       */
      createLessonCard: function(lesson, index) {
        const card = document.createElement('article');
        card.className = 'lesson-card grid-item';
        card.setAttribute('aria-label', `ÿØÿ±ÿ≥: ${lesson.title}`);
        card.setAttribute('data-category', lesson.category);
        card.setAttribute('data-date', lesson.formattedDate);
        card.style.animationDelay = `${index * 0.1}s`;
        
        // Create card content
        card.innerHTML = `
          <div class="lesson-header">
            <h3 class="lesson-title">${Utils.escapeHtml(lesson.title)}</h3>
            <div class="lesson-meta">
              <span class="badge badge-category">üìö ${Utils.escapeHtml(AppConfig.CATEGORIES[lesson.category] || lesson.category)}</span>
              <span class="badge badge-date">üìÖ ${Utils.escapeHtml(lesson.formattedDate)}</span>
              <span class="badge badge-id">#${Utils.escapeHtml(lesson.id)}</span>
            </div>
          </div>
          <div class="lesson-thumbnail">
            ${lesson.thumbnail ? `
              <img src="${lesson.thumbnail}" 
                   alt="ÿµŸàÿ±ÿ© ŸÖÿµÿ∫ÿ±ÿ© ŸÑÿØÿ±ÿ≥: ${Utils.escapeHtml(lesson.title)}" 
                   class="thumbnail-image lazy-load"
                   loading="lazy"
                   referrerpolicy="no-referrer">
              <div class="thumbnail-overlay">
                <div class="play-button" aria-label="ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà">
                  <div class="play-icon"></div>
                </div>
              </div>
            ` : `
              <div class="thumbnail-placeholder">
                <span>üìö</span>
              </div>
              <div class="thumbnail-overlay">
                <div class="play-button" aria-label="ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ">
                  <div class="play-icon"></div>
                </div>
              </div>
            `}
          </div>
          <div class="lesson-actions">
            <button class="action-btn btn-watch" data-action="watch" aria-label="ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿØÿ±ÿ≥">
              <span>‚ñ∂</span>
              <span>ŸÖÿ¥ÿßŸáÿØÿ©</span>
            </button>
            <a href="${lesson.url}" 
               class="action-link btn-download" 
               target="_blank" 
               rel="noopener noreferrer" 
               download 
               aria-label="ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑÿØÿ±ÿ≥">
              <span>‚¨áÔ∏è</span>
              <span>ÿ™ŸÜÿ≤ŸäŸÑ</span>
            </a>
          </div>
          <div class="card-hover-area" aria-hidden="true"></div>
        `;
        
        // Add event listeners
        this.setupCardEvents(card, lesson);
        
        return card;
      },
      
      /**
       * Setup event listeners for lesson card
       * @param {HTMLElement} card - Lesson card element
       * @param {Object} lesson - Lesson object
       */
      setupCardEvents: function(card, lesson) {
        // Main card click - open player
        card.addEventListener('click', (e) => {
          if (e.target.closest('.action-link') || e.target.closest('[data-action="watch"]')) {
            return; // Allow other actions to handle their own clicks
          }
          
          PlayerManager.openPlayer(lesson);
          e.stopPropagation();
        });
        
        // Watch button click
        const watchBtn = card.querySelector('[data-action="watch"]');
        if (watchBtn) {
          watchBtn.addEventListener('click', (e) => {
            PlayerManager.openPlayer(lesson);
            e.stopPropagation();
          });
        }
        
        // Download link setup
        const downloadLink = card.querySelector('.btn-download');
        if (downloadLink && lesson.driveLinks) {
          downloadLink.href = lesson.driveLinks.download;
        }
      },
      
      /**
       * Setup lazy loading for images
       */
      setupLazyLoading: function() {
        if ('IntersectionObserver' in window) {
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                const img = entry.target;
                if (img.dataset.src) {
                  img.src = img.dataset.src;
                }
                img.classList.add('loaded');
                observer.unobserve(img);
              }
            });
          }, {
            rootMargin: AppConfig.LAZY_LOAD_THRESHOLD
          });
          
          document.querySelectorAll('.lazy-load').forEach(img => {
            observer.observe(img);
          });
        } else {
          // Fallback for browsers without IntersectionObserver
          document.querySelectorAll('.lazy-load').forEach(img => {
            if (img.dataset.src) {
              img.src = img.dataset.src;
            }
            img.classList.add('loaded');
          });
        }
      },
      
      /**
       * Show toast notification
       * @param {string} message - Notification message
       * @param {string} type - Notification type (success, error, info, warning)
       */
      showToast: function(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `toast toast-${type} show`;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'polite');
        
        const iconMap = {
          'success': '‚úì',
          'error': '‚úó',
          'warning': '!',
          'info': '‚ìò'
        };
        
        toast.innerHTML = `
          <span class="toast-icon">${iconMap[type] || '‚ìò'}</span>
          <span>${Utils.escapeHtml(message)}</span>
        `;
        
        DOMElements.toastContainer.appendChild(toast);
        
        // Auto hide after duration
        setTimeout(() => {
          toast.classList.remove('show');
          toast.classList.add('hide');
          
          setTimeout(() => {
            if (toast.parentNode === DOMElements.toastContainer) {
              DOMElements.toastContainer.removeChild(toast);
            }
          }, 300);
        }, AppConfig.TOAST_DURATION);
      },
      
      /**
       * Initialize the UI
       */
      initializeUI: function() {
        // Setup event listeners
        this.setupEventListeners();
        
        // Initial render
        this.renderCategories(AppConfig.CATEGORY_ORDER);
        
        AppState.initialized = true;
      },
      
      /**
       * Setup all event listeners
       */
      setupEventListeners: function() {
        // Search input with debounce
        DOMElements.searchInput.addEventListener('input', Utils.debounce(() => {
          DataManager.filterLessons();
        }, 300));
        
        // Category filter
        DOMElements.categorySelect.addEventListener('change', () => {
          DataManager.filterLessons();
        });
        
        // Time filter
        DOMElements.timeSelect.addEventListener('change', () => {
          DataManager.filterLessons();
        });
        
        // Refresh button
        DOMElements.refreshBtn.addEventListener('click', async () => {
          DOMElements.refreshBtn.disabled = true;
          DOMElements.refreshBtn.innerHTML = '<span>‚Üª</span><span>ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ÿØŸäÿ´...</span>';
          
          try {
            await DataManager.loadLessons(true);
            this.showToast('‚úì ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
          } catch (error) {
            this.showToast('‚úó ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'error');
          } finally {
            DOMElements.refreshBtn.disabled = false;
            DOMElements.refreshBtn.innerHTML = '<span>‚ü≥</span><span>ÿ™ÿ≠ÿØŸäÿ´</span>';
          }
        });
        
        // Player modal close
        DOMElements.closePlayerBtn.addEventListener('click', () => {
          PlayerManager.closePlayer();
        });
        
        // Close modal on overlay click
        DOMElements.playerModal.addEventListener('click', (e) => {
          if (e.target === DOMElements.playerModal) {
            PlayerManager.closePlayer();
          }
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            PlayerManager.closePlayer();
          }
        });
        
        // Touch interactions
        if (Utils.isTouchDevice()) {
          document.body.classList.add('touch-device');
        }
        
        // Online/offline detection
        window.addEventListener('online', () => {
          AppState.offlineMode = false;
          this.showToast('‚úì ÿπÿØÿ™ ÿ•ŸÑŸâ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™', 'success');
        });
        
        window.addEventListener('offline', () => {
          AppState.offlineMode = true;
          this.showToast('‚ö† ÿ£ŸÜÿ™ ŸÅŸä Ÿàÿ∂ÿπ ÿπÿØŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ', 'warning');
        });
      }
    };
    
    // ========================
    // PLAYER MANAGEMENT SYSTEM - Enterprise Media
    // ========================
    
    /**
     * Player Management Service
     */
    const PlayerManager = {
      currentPlayer: null,
      currentMedia: null,
      
      /**
       * Open player modal with lesson content
       * @param {Object} lesson - Lesson object
       */
      openPlayer: function(lesson) {
        // Update modal title
        DOMElements.playerTitle.textContent = lesson.title;
        
        // Show modal
        DOMElements.playerModal.classList.add('open');
        DOMElements.playerModal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        
        // Load appropriate media
        this.loadMedia(lesson);
        
        // Track analytics
        this.trackPlay(lesson);
      },
      
      /**
       * Load appropriate media based on content type
       * @param {Object} lesson - Lesson object
       */
      loadMedia: function(lesson) {
        // Clear previous content
        DOMElements.mediaContent.innerHTML = '';
        DOMElements.mediaContent.innerHTML = `
          <div class="loading-indicator">
            <div class="spinner"></div>
            <span>ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ...</span>
          </div>
        `;
        
        // Determine media type and load accordingly
        switch(lesson.type) {
          case 'youtube':
            this.loadYouTubePlayer(lesson);
            break;
          case 'drive':
            this.loadDrivePlayer(lesson);
            break;
          case 'video':
            this.loadVideoPlayer(lesson);
            break;
          case 'pdf':
            this.loadPDFViewer(lesson);
            break;
          case 'image':
            this.loadImageViewer(lesson);
            break;
          default:
            this.loadGenericContent(lesson);
        }
      },
      
      /**
       * Load YouTube player
       * @param {Object} lesson - Lesson object
       */
      loadYouTubePlayer: function(lesson) {
        if (!lesson.youtubeId) {
          UIRenderer.showToast('‚úó ŸÖÿπÿ±ŸÅ ŸÅŸäÿØŸäŸà YouTube ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠', 'error');
          return;
        }
        
        const iframe = document.createElement('iframe');
        iframe.className = 'media-element';
        iframe.src = `https://www.youtube-nocookie.com/embed/${lesson.youtubeId}?autoplay=1&modestbranding=1&rel=0&controls=1&showinfo=0&iv_load_policy=3`;
        iframe.title = lesson.title;
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
        iframe.allowFullscreen = true;
        iframe.frameBorder = '0';
        
        DOMElements.mediaContent.innerHTML = '';
        DOMElements.mediaContent.appendChild(iframe);
        this.currentMedia = iframe;
      },
      
      /**
       * Load Google Drive player
       * @param {Object} lesson - Lesson object
       */
      loadDrivePlayer: function(lesson) {
        if (!lesson.driveLinks || !lesson.driveLinks.preview) {
          UIRenderer.showToast('‚úó ÿ±ÿßÿ®ÿ∑ Google Drive ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠', 'error');
          return;
        }
        
        const iframe = document.createElement('iframe');
        iframe.className = 'media-element';
        iframe.src = lesson.driveLinks.preview;
        iframe.title = lesson.title;
        iframe.allow = 'autoplay; encrypted-media; fullscreen; picture-in-picture';
        iframe.allowFullscreen = true;
        iframe.frameBorder = '0';
        iframe.sandbox = 'allow-same-origin allow-scripts allow-popups allow-forms';
        
        DOMElements.mediaContent.innerHTML = '';
        DOMElements.mediaContent.appendChild(iframe);
        this.currentMedia = iframe;
        
        // Attempt to enter fullscreen on mobile
        setTimeout(() => {
          this.requestFullscreen(iframe);
        }, 1000);
      },
      
      /**
       * Load native video player
       * @param {Object} lesson - Lesson object
       */
      loadVideoPlayer: function(lesson) {
        const video = document.createElement('video');
        video.className = 'media-element';
        video.controls = true;
        video.autoplay = true;
        video.playsInline = true;
        video.preload = 'auto';
        video.title = lesson.title;
        
        // Create source element
        const source = document.createElement('source');
        source.src = lesson.url;
        source.type = this.getVideoMimeType(lesson.url);
        
        video.appendChild(source);
        
        // Add error handling
        video.addEventListener('error', () => {
          UIRenderer.showToast('‚úó ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà', 'error');
          DOMElements.mediaContent.innerHTML = `
            <div class="error-message">
              <p>ÿ™ÿπÿ∞ÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà. ÿ≠ÿßŸàŸÑ ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÖŸÑŸÅ Ÿàÿ™ÿ¥ÿ∫ŸäŸÑŸá ŸÖÿ≠ŸÑŸäÿßŸã.</p>
              <a href="${lesson.url}" class="btn btn-primary" download>ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÅŸäÿØŸäŸà</a>
            </div>
          `;
        });
        
        DOMElements.mediaContent.innerHTML = '';
        DOMElements.mediaContent.appendChild(video);
        this.currentMedia = video;
        
        // Attempt to play (may require user gesture)
        setTimeout(() => {
          video.play().catch(e => {
            console.warn('Autoplay prevented:', e);
          });
        }, 500);
      },
      
      /**
       * Get video MIME type from URL
       * @param {string} url - Video URL
       * @returns {string} MIME type
       */
      getVideoMimeType: function(url) {
        const extension = url.split('.').pop().toLowerCase();
        const mimeTypes = {
          'mp4': 'video/mp4',
          'webm': 'video/webm',
          'ogg': 'video/ogg',
          'mov': 'video/quicktime',
          'm4v': 'video/mp4',
          'mkv': 'video/x-matroska',
          'avi': 'video/x-msvideo'
        };
        return mimeTypes[extension] || 'video/mp4';
      },
      
      /**
       * Load PDF viewer
       * @param {Object} lesson - Lesson object
       */
      loadPDFViewer: function(lesson) {
        // Use Google Drive viewer for PDFs if available
        if (lesson.driveLinks && lesson.driveLinks.view) {
          const iframe = document.createElement('iframe');
          iframe.className = 'media-element';
          iframe.src = `https://drive.google.com/file/d/${lesson.driveLinks.id}/preview`;
          iframe.title = lesson.title;
          iframe.allow = 'autoplay; encrypted-media; fullscreen';
          iframe.allowFullscreen = true;
          iframe.frameBorder = '0';
          
          DOMElements.mediaContent.innerHTML = '';
          DOMElements.mediaContent.appendChild(iframe);
          this.currentMedia = iframe;
        } else {
          // Fallback to direct link
          DOMElements.mediaContent.innerHTML = `
            <div class="error-message">
              <p>ŸÑÿß ŸäŸÖŸÉŸÜ ÿπÿ±ÿ∂ ŸÖŸÑŸÅ PDF ŸÖÿ®ÿßÿ¥ÿ±ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ŸÑÿπÿ±ÿ∂Ÿá.</p>
              <a href="${lesson.url}" class="btn btn-primary" target="_blank" rel="noopener">ŸÅÿ™ÿ≠ ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿ¨ÿØŸäÿØÿ©</a>
            </div>
          `;
        }
      },
      
      /**
       * Load image viewer
       * @param {Object} lesson - Lesson object
       */
      loadImageViewer: function(lesson) {
        const img = document.createElement('img');
        img.className = 'media-element';
        img.src = lesson.url;
        img.alt = lesson.title;
        img.loading = 'lazy';
        
        img.addEventListener('error', () => {
          UIRenderer.showToast('‚úó ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©', 'error');
          DOMElements.mediaContent.innerHTML = `
            <div class="error-message">
              <p>ÿ™ÿπÿ∞ÿ± ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©. ÿ≠ÿßŸàŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅÿ≠ÿ© ÿ£Ÿà ÿßŸÑÿ™ŸÜÿ≤ŸäŸÑ.</p>
              <a href="${lesson.url}" class="btn btn-primary" download>ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©</a>
            </div>
          `;
        });
        
        DOMElements.mediaContent.innerHTML = '';
        DOMElements.mediaContent.appendChild(img);
        this.currentMedia = img;
      },
      
      /**
       * Load generic content
       * @param {Object} lesson - Lesson object
       */
      loadGenericContent: function(lesson) {
        DOMElements.mediaContent.innerHTML = `
          <div class="error-message">
            <p>ŸÑÿß ŸäŸÖŸÉŸÜ ÿπÿ±ÿ∂ Ÿáÿ∞ÿß ÿßŸÑŸÜŸàÿπ ŸÖŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÖÿ®ÿßÿ¥ÿ±ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ŸÑÿπÿ±ÿ∂Ÿá.</p>
            <a href="${lesson.url}" class="btn btn-primary" target="_blank" rel="noopener">ŸÅÿ™ÿ≠ ŸÅŸä ŸÜÿßŸÅÿ∞ÿ© ÿ¨ÿØŸäÿØÿ©</a>
            <a href="${lesson.url}" class="btn btn-download" download>ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÖŸÑŸÅ</a>
          </div>
        `;
      },
      
      /**
       * Request fullscreen for an element
       * @param {HTMLElement} element - Element to make fullscreen
       */
      requestFullscreen: function(element) {
        if (!element) return;
        
        try {
          if (element.requestFullscreen) {
            element.requestFullscreen();
          } else if (element.mozRequestFullScreen) {
            element.mozRequestFullScreen();
          } else if (element.webkitRequestFullscreen) {
            element.webkitRequestFullscreen();
          } else if (element.msRequestFullscreen) {
            element.msRequestFullscreen();
          }
        } catch (error) {
          console.warn('Fullscreen request failed:', error);
        }
      },
      
      /**
       * Close player modal
       */
      closePlayer: function() {
        DOMElements.playerModal.classList.remove('open');
        DOMElements.playerModal.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        
        // Clear media content
        DOMElements.mediaContent.innerHTML = `
          <div class="loading-indicator">
            <div class="spinner"></div>
            <span>ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</span>
          </div>
        `;
        
        // Clean up current player
        if (this.currentPlayer) {
          if (typeof this.currentPlayer.dispose === 'function') {
            this.currentPlayer.dispose();
          }
          this.currentPlayer = null;
        }
        
        if (this.currentMedia) {
          if (this.currentMedia.tagName === 'VIDEO') {
            this.currentMedia.pause();
            this.currentMedia.src = '';
          }
          this.currentMedia = null;
        }
      },
      
      /**
       * Track play analytics
       * @param {Object} lesson - Lesson object
       */
      trackPlay: function(lesson) {
        // In a real application, this would send analytics data
        console.log('Lesson played:', {
          id: lesson.id,
          title: lesson.title,
          category: lesson.category,
          timestamp: new Date().toISOString()
        });
        
        // Show subtle toast for feedback
        setTimeout(() => {
          UIRenderer.showToast(`‚ñ∂ ÿ™ÿ¥ÿ∫ŸäŸÑ: ${lesson.title.substring(0, 30)}${lesson.title.length > 30 ? '...' : ''}`, 'info');
        }, 500);
      }
    };
    
    // ========================
    // APPLICATION INITIALIZATION - Production Ready
    // ========================
    
    /**
     * Initialize the application
     */
    async function initializeApplication() {
      try {
        // Initialize UI first
        UIRenderer.initializeUI();
        
        // Load lessons data
        await DataManager.loadLessons();
        
        // Get unique categories and render
        const categories = DataManager.getUniqueCategories();
        UIRenderer.renderCategories(categories);
        
        // Apply initial filters
        DataManager.filterLessons();
        
        // Show success toast
        UIRenderer.showToast('‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
        
      } catch (error) {
        console.error('Application initialization error:', error);
        UIRenderer.showToast('‚úó ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ', 'error');
        
        // Still attempt to render something usable
        DataManager.filterLessons();
      }
    }
    
    // ========================
    // ENTRY POINT - Enterprise Boot Sequence
    // ========================
    
    // Check if DOM is already loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApplication);
    } else {
      initializeApplication();
    }
    
    // Handle page visibility changes
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') {
        // Refresh data if it's been a while
        const now = Date.now();
        if (now - AppState.cacheTimestamp > AppConfig.CACHE_DURATION / 2) {
          DataManager.loadLessons();
        }
      }
    });
    
    // Handle beforeunload for cleanup
    window.addEventListener('beforeunload', () => {
      PlayerManager.closePlayer();
    });
    
    // Progressive enhancement for older browsers
    if (!window.Promise) {
      console.warn('Promise not supported. Application may not work correctly.');
    }
    
    if (!window.fetch) {
      console.warn('Fetch API not supported. Application may not work correctly.');
    }
  </script>
</body>
</html>